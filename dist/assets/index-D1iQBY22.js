(function(){const A=document.createElement("link").relList;if(A&&A.supports&&A.supports("modulepreload"))return;for(const N of document.querySelectorAll('link[rel="modulepreload"]'))x(N);new MutationObserver(N=>{for(const q of N)if(q.type==="childList")for(const E of q.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&x(E)}).observe(document,{childList:!0,subtree:!0});function C(N){const q={};return N.integrity&&(q.integrity=N.integrity),N.referrerPolicy&&(q.referrerPolicy=N.referrerPolicy),N.crossOrigin==="use-credentials"?q.credentials="include":N.crossOrigin==="anonymous"?q.credentials="omit":q.credentials="same-origin",q}function x(N){if(N.ep)return;N.ep=!0;const q=C(N);fetch(N.href,q)}})();class yo{constructor(A,C){this.routes=A,this.outlet=C,this.currentParams={},window.addEventListener("hashchange",()=>this.resolve()),this.resolve()}resolve(){const A=window.location.hash.slice(1)||"/",C=this.match(A);if(C){if(C.guard&&!C.guard())return this.navigate(C.redirect||"/login");this.currentParams=C.params,this.render(C.component)}else console.log("404 Not Found",A),this.navigate("/")}match(A){for(const C of this.routes){if(C.path===A)return{...C,params:{}};if(C.path.includes(":")){const x=C.path.split("/"),N=A.split("/");if(x.length===N.length){const q={};let E=!0;for(let D=0;D<x.length;D++)if(x[D].startsWith(":"))q[x[D].slice(1)]=N[D];else if(x[D]!==N[D]){E=!1;break}if(E)return{...C,params:q}}}}return null}navigate(A){window.location.hash=A}async render(A){this.outlet.innerHTML="";const C=await A(this.currentParams);C&&(typeof C=="string"?this.outlet.innerHTML=C:this.outlet.appendChild(C))}}var Ar=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function go(w){return w&&w.__esModule&&Object.prototype.hasOwnProperty.call(w,"default")?w.default:w}var Dr={exports:{}};(function(w,A){((C,x)=>{w.exports=x()})(Ar,function(){var C=function(e,t){return(C=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(n,r){n.__proto__=r}:function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])}))(e,t)},x=function(){return(x=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function N(e,t,n){for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||((r=r||Array.prototype.slice.call(t,0,o))[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}var q=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Ar,E=Object.keys,D=Array.isArray;function L(e,t){return typeof t=="object"&&E(t).forEach(function(n){e[n]=t[n]}),e}typeof Promise>"u"||q.Promise||(q.Promise=Promise);var G=Object.getPrototypeOf,he={}.hasOwnProperty;function te(e,t){return he.call(e,t)}function F(e,t){typeof t=="function"&&(t=t(G(e))),(typeof Reflect>"u"?E:Reflect.ownKeys)(t).forEach(function(n){ce(e,n,t[n])})}var se=Object.defineProperty;function ce(e,t,n,r){se(e,t,L(n&&te(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function me(e){return{from:function(t){return e.prototype=Object.create(t.prototype),ce(e.prototype,"constructor",e),{extend:F.bind(null,e.prototype)}}}}var Ve=Object.getOwnPropertyDescriptor,Ir=[].slice;function wt(e,t,n){return Ir.call(e,t,n)}function Nn(e,t){return t(e)}function rt(e){if(!e)throw new Error("Assertion Failed")}function $n(e){q.setImmediate?setImmediate(e):setTimeout(e,0)}function we(e,t){if(typeof t=="string"&&te(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var n=[],r=0,o=t.length;r<o;++r){var a=we(e,t[r]);n.push(a)}return n}var i,s=t.indexOf(".");return s===-1||(i=e[t.substr(0,s)])==null?void 0:we(i,t.substr(s+1))}function ue(e,t,n){if(e&&t!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){rt(typeof n!="string"&&"length"in n);for(var r=0,o=t.length;r<o;++r)ue(e,t[r],n[r])}else{var a,i,s=t.indexOf(".");s!==-1?(a=t.substr(0,s),(s=t.substr(s+1))===""?n===void 0?D(e)&&!isNaN(parseInt(a))?e.splice(a,1):delete e[a]:e[a]=n:ue(i=(i=e[a])&&te(e,a)?i:e[a]={},s,n)):n===void 0?D(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function Fn(e){var t,n={};for(t in e)te(e,t)&&(n[t]=e[t]);return n}var qr=[].concat;function Un(e){return qr.apply([],e)}var ke="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Un([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return q[e]}),Vn=new Set(ke.map(function(e){return q[e]})),ot=null;function De(e){return ot=new WeakMap,e=function t(n){if(!n||typeof n!="object")return n;var r=ot.get(n);if(r)return r;if(D(n)){r=[],ot.set(n,r);for(var o=0,a=n.length;o<a;++o)r.push(t(n[o]))}else if(Vn.has(n.constructor))r=n;else{var i,s=G(n);for(i in r=s===Object.prototype?{}:Object.create(s),ot.set(n,r),n)te(n,i)&&(r[i]=t(n[i]))}return r}(e),ot=null,e}var Rr={}.toString;function Yt(e){return Rr.call(e).slice(8,-1)}var Qt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Br=typeof Qt=="symbol"?function(e){var t;return e!=null&&(t=e[Qt])&&t.apply(e)}:function(){return null};function Te(e,t){t=e.indexOf(t),0<=t&&e.splice(t,1)}var ze={};function xe(e){var t,n,r,o;if(arguments.length===1){if(D(e))return e.slice();if(this===ze&&typeof e=="string")return[e];if(o=Br(e))for(n=[];!(r=o.next()).done;)n.push(r.value);else{if(e==null)return[e];if(typeof(t=e.length)!="number")return[e];for(n=new Array(t);t--;)n[t]=e[t]}}else for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var Xt=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ke=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],de=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ke),Mr={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function He(e,t){this.name=e,this.message=t}function zn(e,t){return e+". Errors: "+Object.keys(t).map(function(n){return t[n].toString()}).filter(function(n,r,o){return o.indexOf(n)===r}).join(`
`)}function xt(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=zn(e,t)}function We(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(n){return t[n]}),this.failuresByPos=t,this.message=zn(e,this.failures)}me(He).from(Error).extend({toString:function(){return this.name+": "+this.message}}),me(xt).from(He),me(We).from(He);var Zt=de.reduce(function(e,t){return e[t]=t+"Error",e},{}),Lr=He,B=de.reduce(function(e,t){var n=t+"Error";function r(o,a){this.name=n,o?typeof o=="string"?(this.message="".concat(o).concat(a?`
 `+a:""),this.inner=a||null):typeof o=="object"&&(this.message="".concat(o.name," ").concat(o.message),this.inner=o):(this.message=Mr[t]||n,this.inner=null)}return me(r).from(Lr),e[t]=r,e},{}),Hn=(B.Syntax=SyntaxError,B.Type=TypeError,B.Range=RangeError,ke.reduce(function(e,t){return e[t+"Error"]=B[t],e},{}));ke=de.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=B[t]),e},{});function W(){}function at(e){return e}function Nr(e,t){return e==null||e===at?t:function(n){return t(e(n))}}function Ie(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function $r(e,t){return e===W?t:function(){var n=e.apply(this,arguments),r=(n!==void 0&&(arguments[0]=n),this.onsuccess),o=this.onerror,a=(this.onsuccess=null,this.onerror=null,t.apply(this,arguments));return r&&(this.onsuccess=this.onsuccess?Ie(r,this.onsuccess):r),o&&(this.onerror=this.onerror?Ie(o,this.onerror):o),a!==void 0?a:n}}function Fr(e,t){return e===W?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Ie(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Ie(r,this.onerror):r)}}function Ur(e,t){return e===W?t:function(o){var r=e.apply(this,arguments),o=(L(o,r),this.onsuccess),a=this.onerror,i=(this.onsuccess=null,this.onerror=null,t.apply(this,arguments));return o&&(this.onsuccess=this.onsuccess?Ie(o,this.onsuccess):o),a&&(this.onerror=this.onerror?Ie(a,this.onerror):a),r===void 0?i===void 0?void 0:i:L(r,i)}}function Vr(e,t){return e===W?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function en(e,t){return e===W?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,o=arguments.length,a=new Array(o);o--;)a[o]=arguments[o];return n.then(function(){return t.apply(r,a)})}return t.apply(this,arguments)}}ke.ModifyError=xt,ke.DexieError=He,ke.BulkError=We;var ve=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Wn(e){ve=e}var it={},Jn=100,st=typeof Promise>"u"?[]:(de=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[st=crypto.subtle.digest("SHA-512",new Uint8Array([0])),G(st),de]:[de,G(de),de]),de=st[0],tt=st[1],tt=tt&&tt.then,qe=de&&de.constructor,tn=!!st[2],ut=function(e,t){lt.push([e,t]),kt&&(queueMicrotask(Hr),kt=!1)},nn=!0,kt=!0,Re=[],_t=[],rn=at,Se={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:W,pgp:!1,env:{},finalize:W},R=Se,lt=[],Be=0,Et=[];function j(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=R;if(typeof e!="function"){if(e!==it)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&an(this,this._value)}else this._state=null,this._value=null,++t.ref,function n(r,o){try{o(function(a){if(r._state===null){if(a===r)throw new TypeError("A promise cannot be resolved with itself.");var i=r._lib&&Je();a&&typeof a.then=="function"?n(r,function(s,c){a instanceof j?a._then(s,c):a.then(s,c)}):(r._state=!0,r._value=a,Yn(r)),i&&Ge()}},an.bind(null,r))}catch(a){an(r,a)}}(this,e)}var on={get:function(){var e=R,t=At;function n(r,o){var a=this,i=!e.global&&(e!==R||t!==At),s=i&&!Pe(),c=new j(function(v,d){sn(a,new Gn(Xn(r,e,i,s),Xn(o,e,i,s),v,d,e))});return this._consoleTask&&(c._consoleTask=this._consoleTask),c}return n.prototype=it,n},set:function(e){ce(this,"then",e&&e.prototype===it?on:{get:function(){return e},set:on.set})}};function Gn(e,t,n,r,o){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=n,this.reject=r,this.psd=o}function an(e,t){var n,r;_t.push(t),e._state===null&&(n=e._lib&&Je(),t=rn(t),e._state=!1,e._value=t,r=e,Re.some(function(o){return o._value===r._value})||Re.push(r),Yn(e),n)&&Ge()}function Yn(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)sn(e,t[n]);var o=e._PSD;--o.ref||o.finalize(),Be===0&&(++Be,ut(function(){--Be==0&&un()},[]))}function sn(e,t){if(e._state===null)e._listeners.push(t);else{var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Be,ut(zr,[n,e,t])}}function zr(e,t,n){try{var r,o=t._value;!t._state&&_t.length&&(_t=[]),r=ve&&t._consoleTask?t._consoleTask.run(function(){return e(o)}):e(o),t._state||_t.indexOf(o)!==-1||(a=>{for(var i=Re.length;i;)if(Re[--i]._value===a._value)return Re.splice(i,1)})(t),n.resolve(r)}catch(a){n.reject(a)}finally{--Be==0&&un(),--n.psd.ref||n.psd.finalize()}}function Hr(){Me(Se,function(){Je()&&Ge()})}function Je(){var e=nn;return kt=nn=!1,e}function Ge(){var e,t,n;do for(;0<lt.length;)for(e=lt,lt=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}while(0<lt.length);kt=nn=!0}function un(){for(var e=Re,t=(Re=[],e.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)}),Et.slice(0)),n=t.length;n;)t[--n]()}function St(e){return new j(it,!1,e)}function Y(e,t){var n=R;return function(){var r=Je(),o=R;try{return Ae(n,!0),e.apply(this,arguments)}catch(a){t&&t(a)}finally{Ae(o,!1),r&&Ge()}}}F(j.prototype,{then:on,_then:function(e,t){sn(this,new Gn(null,null,e,t,R))},catch:function(e){var t,n;return arguments.length===1?this.then(null,e):(t=e,n=arguments[1],typeof t=="function"?this.then(null,function(r){return(r instanceof t?n:St)(r)}):this.then(null,function(r){return(r&&r.name===t?n:St)(r)}))},finally:function(e){return this.then(function(t){return j.resolve(e()).then(function(){return t})},function(t){return j.resolve(e()).then(function(){return St(t)})})},timeout:function(e,t){var n=this;return e<1/0?new j(function(r,o){var a=setTimeout(function(){return o(new B.Timeout(t))},e);n.then(r,o).finally(clearTimeout.bind(null,a))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&ce(j.prototype,Symbol.toStringTag,"Dexie.Promise"),Se.env=Qn(),F(j,{all:function(){var e=xe.apply(null,arguments).map(Ct);return new j(function(t,n){e.length===0&&t([]);var r=e.length;e.forEach(function(o,a){return j.resolve(o).then(function(i){e[a]=i,--r||t(e)},n)})})},resolve:function(e){return e instanceof j?e:e&&typeof e.then=="function"?new j(function(t,n){e.then(t,n)}):new j(it,!0,e)},reject:St,race:function(){var e=xe.apply(null,arguments).map(Ct);return new j(function(t,n){e.map(function(r){return j.resolve(r).then(t,n)})})},PSD:{get:function(){return R},set:function(e){return R=e}},totalEchoes:{get:function(){return At}},newPSD:Oe,usePSD:Me,scheduler:{get:function(){return ut},set:function(e){ut=e}},rejectionMapper:{get:function(){return rn},set:function(e){rn=e}},follow:function(e,t){return new j(function(n,r){return Oe(function(o,a){var i=R;i.unhandleds=[],i.onunhandled=a,i.finalize=Ie(function(){var s,c=this;s=function(){c.unhandleds.length===0?o():a(c.unhandleds[0])},Et.push(function v(){s(),Et.splice(Et.indexOf(v),1)}),++Be,ut(function(){--Be==0&&un()},[])},i.finalize),e()},t,n,r)})}}),qe&&(qe.allSettled&&ce(j,"allSettled",function(){var e=xe.apply(null,arguments).map(Ct);return new j(function(t){e.length===0&&t([]);var n=e.length,r=new Array(n);e.forEach(function(o,a){return j.resolve(o).then(function(i){return r[a]={status:"fulfilled",value:i}},function(i){return r[a]={status:"rejected",reason:i}}).then(function(){return--n||t(r)})})})}),qe.any&&typeof AggregateError<"u"&&ce(j,"any",function(){var e=xe.apply(null,arguments).map(Ct);return new j(function(t,n){e.length===0&&n(new AggregateError([]));var r=e.length,o=new Array(r);e.forEach(function(a,i){return j.resolve(a).then(function(s){return t(s)},function(s){o[i]=s,--r||n(new AggregateError(o))})})})}),qe.withResolvers)&&(j.withResolvers=qe.withResolvers);var ne={awaits:0,echoes:0,id:0},Wr=0,Ot=[],Pt=0,At=0,Jr=0;function Oe(e,i,n,r){var o=R,a=Object.create(o),i=(a.parent=o,a.ref=0,a.global=!1,a.id=++Jr,Se.env,a.env=tn?{Promise:j,PromiseProp:{value:j,configurable:!0,writable:!0},all:j.all,race:j.race,allSettled:j.allSettled,any:j.any,resolve:j.resolve,reject:j.reject}:{},i&&L(a,i),++o.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()},Me(a,e,n,r));return a.ref===0&&a.finalize(),i}function Ye(){return ne.id||(ne.id=++Wr),++ne.awaits,ne.echoes+=Jn,ne.id}function Pe(){return!!ne.awaits&&(--ne.awaits==0&&(ne.id=0),ne.echoes=ne.awaits*Jn,!0)}function Ct(e){return ne.echoes&&e&&e.constructor===qe?(Ye(),e.then(function(t){return Pe(),t},function(t){return Pe(),Z(t)})):e}function Gr(){var e=Ot[Ot.length-1];Ot.pop(),Ae(e,!1)}function Ae(e,t){var n,r,o=R;(t?!ne.echoes||Pt++&&e===R:!Pt||--Pt&&e===R)||queueMicrotask(t?(function(a){++At,ne.echoes&&--ne.echoes!=0||(ne.echoes=ne.awaits=ne.id=0),Ot.push(R),Ae(a,!0)}).bind(null,e):Gr),e!==R&&(R=e,o===Se&&(Se.env=Qn()),tn)&&(n=Se.env.Promise,r=e.env,o.global||e.global)&&(Object.defineProperty(q,"Promise",r.PromiseProp),n.all=r.all,n.race=r.race,n.resolve=r.resolve,n.reject=r.reject,r.allSettled&&(n.allSettled=r.allSettled),r.any)&&(n.any=r.any)}function Qn(){var e=q.Promise;return tn?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(q,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function Me(e,t,n,r,o){var a=R;try{return Ae(e,!0),t(n,r,o)}finally{Ae(a,!1)}}function Xn(e,t,n,r){return typeof e!="function"?e:function(){var o=R;n&&Ye(),Ae(t,!0);try{return e.apply(this,arguments)}finally{Ae(o,!1),r&&queueMicrotask(Pe)}}}function ln(e){Promise===qe&&ne.echoes===0?Pt===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+tt).indexOf("[native code]")===-1&&(Ye=Pe=W);var Z=j.reject,Le="ï¿¿",_e="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Zn="String expected.",Qe=[],jt="__dbnames",cn="readonly",dn="readwrite";function Ne(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var er={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Kt(e){return typeof e!="string"||/\./.test(e)?function(t){return t}:function(t){return t[e]===void 0&&e in t&&delete(t=De(t))[e],t}}function tr(){throw B.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function U(e,t){try{var n=nr(e),r=nr(t);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":for(var o=rr(e),a=rr(t),i=o.length,s=a.length,c=i<s?i:s,v=0;v<c;++v)if(o[v]!==a[v])return o[v]<a[v]?-1:1;return i===s?0:i<s?-1:1;case"Array":for(var d=e,u=t,p=d.length,h=u.length,f=p<h?p:h,l=0;l<f;++l){var y=U(d[l],u[l]);if(y!==0)return y}return p===h?0:p<h?-1:1}}catch{}return NaN}function nr(e){var t=typeof e;return t=="object"&&(ArrayBuffer.isView(e)||(t=Yt(e))==="ArrayBuffer")?"binary":t}function rr(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function Dt(e,t,n){var r=e.schema.yProps;return r?(t&&0<n.numFailures&&(t=t.filter(function(o,a){return!n.failures[a]})),Promise.all(r.map(function(o){return o=o.updatesTable,t?e.db.table(o).where("k").anyOf(t).delete():e.db.table(o).clear()})).then(function(){return n})):n}or.prototype.execute=function(e){var t=this["@@propmod"];if(t.add!==void 0){var n=t.add;if(D(n))return N(N([],D(e)?e:[],!0),n).sort();if(typeof n=="number")return(Number(e)||0)+n;if(typeof n=="bigint")try{return BigInt(e)+n}catch{return BigInt(0)+n}throw new TypeError("Invalid term ".concat(n))}if(t.remove!==void 0){var r=t.remove;if(D(r))return D(e)?e.filter(function(o){return!r.includes(o)}).sort():[];if(typeof r=="number")return Number(e)-r;if(typeof r=="bigint")try{return BigInt(e)-r}catch{return BigInt(0)-r}throw new TypeError("Invalid subtrahend ".concat(r))}return n=(n=t.replacePrefix)==null?void 0:n[0],n&&typeof e=="string"&&e.startsWith(n)?t.replacePrefix[1]+e.substring(n.length):e};var ct=or;function or(e){this["@@propmod"]=e}function ar(e,t){for(var n=E(t),r=n.length,o=!1,a=0;a<r;++a){var i=n[a],s=t[i],c=we(e,i);s instanceof ct?(ue(e,i,s.execute(c)),o=!0):c!==s&&(ue(e,i,s),o=!0)}return o}J.prototype._trans=function(e,t,n){var r=this._tx||R.trans,o=this.name,a=ve&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function i(v,d,u){if(u.schema[o])return t(u.idbtrans,u);throw new B.NotFound("Table "+o+" not part of transaction")}var s=Je();try{var c=r&&r.db._novip===this.db._novip?r===R.trans?r._promise(e,i,n):Oe(function(){return r._promise(e,i,n)},{trans:r,transless:R.transless||R}):function v(d,u,p,h){if(d.idbdb&&(d._state.openComplete||R.letThrough||d._vip)){var f=d._createTransaction(u,p,d._dbSchema);try{f.create(),d._state.PR1398_maxLoop=3}catch(l){return l.name===Zt.InvalidState&&d.isOpen()&&0<--d._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),d.close({disableAutoOpen:!1}),d.open().then(function(){return v(d,u,p,h)})):Z(l)}return f._promise(u,function(l,y){return Oe(function(){return R.trans=f,h(l,y,f)})}).then(function(l){if(u==="readwrite")try{f.idbtrans.commit()}catch{}return u==="readonly"?l:f._completion.then(function(){return l})})}if(d._state.openComplete)return Z(new B.DatabaseClosed(d._state.dbOpenError));if(!d._state.isBeingOpened){if(!d._state.autoOpen)return Z(new B.DatabaseClosed);d.open().catch(W)}return d._state.dbReadyPromise.then(function(){return v(d,u,p,h)})}(this.db,e,[this.name],i);return a&&(c._consoleTask=a,c=c.catch(function(v){return console.trace(v),Z(v)})),c}finally{s&&Ge()}},J.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?Z(new B.Type("Invalid argument to Table.get()")):this._trans("readonly",function(r){return n.core.get({trans:r,key:e}).then(function(o){return n.hook.reading.fire(o)})}).then(t)},J.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(D(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=E(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(s){if(s.compound&&t.every(function(v){return 0<=s.keyPath.indexOf(v)})){for(var c=0;c<t.length;++c)if(t.indexOf(s.keyPath[c])===-1)return!1;return!0}return!1}).sort(function(s,c){return s.keyPath.length-c.keyPath.length})[0];if(n&&this.db._maxKey!==Le)return i=n.keyPath.slice(0,t.length),this.where(i).equals(i.map(function(s){return e[s]}));!n&&ve&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var r=this.schema.idxByName;function o(s,c){return U(s,c)===0}var i=t.reduce(function(d,c){var v=d[0],d=d[1],u=r[c],p=e[c];return[v||u,v||!u?Ne(d,u&&u.multi?function(h){return h=we(h,c),D(h)&&h.some(function(f){return o(p,f)})}:function(h){return o(p,we(h,c))}):d]},[null,null]),a=i[0],i=i[1];return a?this.where(a.name).equals(e[a.keyPath]).filter(i):n?this.filter(i):this.where(t).equals("")},J.prototype.filter=function(e){return this.toCollection().and(e)},J.prototype.count=function(e){return this.toCollection().count(e)},J.prototype.offset=function(e){return this.toCollection().offset(e)},J.prototype.limit=function(e){return this.toCollection().limit(e)},J.prototype.each=function(e){return this.toCollection().each(e)},J.prototype.toArray=function(e){return this.toCollection().toArray(e)},J.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},J.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,D(e)?"[".concat(e.join("+"),"]"):e))},J.prototype.reverse=function(){return this.toCollection().reverse()},J.prototype.mapToClass=function(e){for(var t=this.db,n=this.name,r=((this.schema.mappedClass=e).prototype instanceof tr&&(e=(i=>{var s=d,c=i;if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");function v(){this.constructor=s}function d(){return i!==null&&i.apply(this,arguments)||this}return C(s,c),s.prototype=c===null?Object.create(c):(v.prototype=c.prototype,new v),Object.defineProperty(d.prototype,"db",{get:function(){return t},enumerable:!1,configurable:!0}),d.prototype.table=function(){return n},d})(e)),new Set),o=e.prototype;o;o=G(o))Object.getOwnPropertyNames(o).forEach(function(i){return r.add(i)});function a(i){if(!i)return i;var s,c=Object.create(e.prototype);for(s in i)if(!r.has(s))try{c[s]=i[s]}catch{}return c}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=a,this.hook("reading",a),e},J.prototype.defineClass=function(){return this.mapToClass(function(e){L(this,e)})},J.prototype.add=function(e,t){var n=this,r=this.schema.primKey,o=r.auto,a=r.keyPath,i=e;return a&&o&&(i=Kt(a)(e)),this._trans("readwrite",function(s){return n.core.mutate({trans:s,type:"add",keys:t!=null?[t]:null,values:[i]})}).then(function(s){return s.numFailures?j.reject(s.failures[0]):s.lastResult}).then(function(s){if(a)try{ue(e,a,s)}catch{}return s})},J.prototype.upsert=function(e,t){var n=this,r=this.schema.primKey.keyPath;return this._trans("readwrite",function(o){return n.core.get({trans:o,key:e}).then(function(a){var i=a??{};return ar(i,t),r&&ue(i,r,e),n.core.mutate({trans:o,type:"put",values:[i],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[t]}}).then(function(s){return s.numFailures?j.reject(s.failures[0]):!!a})})})},J.prototype.update=function(e,t){return typeof e!="object"||D(e)?this.where(":id").equals(e).modify(t):(e=we(e,this.schema.primKey.keyPath))===void 0?Z(new B.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t)},J.prototype.put=function(e,t){var n=this,r=this.schema.primKey,o=r.auto,a=r.keyPath,i=e;return a&&o&&(i=Kt(a)(e)),this._trans("readwrite",function(s){return n.core.mutate({trans:s,type:"put",values:[i],keys:t!=null?[t]:null})}).then(function(s){return s.numFailures?j.reject(s.failures[0]):s.lastResult}).then(function(s){if(a)try{ue(e,a,s)}catch{}return s})},J.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]}).then(function(r){return Dt(t,[e],r)}).then(function(r){return r.numFailures?j.reject(r.failures[0]):void 0})})},J.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:er}).then(function(n){return Dt(e,null,n)})}).then(function(t){return t.numFailures?j.reject(t.failures[0]):void 0})},J.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(n){return t.core.getMany({keys:e,trans:n}).then(function(r){return r.map(function(o){return t.hook.reading.fire(o)})})})},J.prototype.bulkAdd=function(e,t,n){var r=this,o=Array.isArray(t)?t:void 0,a=(n=n||(o?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(i){var s=r.schema.primKey,v=s.auto,s=s.keyPath;if(s&&o)throw new B.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new B.InvalidArgument("Arguments objects and keys must have the same length");var c=e.length,v=s&&v?e.map(Kt(s)):e;return r.core.mutate({trans:i,type:"add",keys:o,values:v,wantResults:a}).then(function(d){var u=d.numFailures,p=d.failures;if(u===0)return a?d.results:d.lastResult;throw new We("".concat(r.name,".bulkAdd(): ").concat(u," of ").concat(c," operations failed"),p)})})},J.prototype.bulkPut=function(e,t,n){var r=this,o=Array.isArray(t)?t:void 0,a=(n=n||(o?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(i){var s=r.schema.primKey,v=s.auto,s=s.keyPath;if(s&&o)throw new B.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new B.InvalidArgument("Arguments objects and keys must have the same length");var c=e.length,v=s&&v?e.map(Kt(s)):e;return r.core.mutate({trans:i,type:"put",keys:o,values:v,wantResults:a}).then(function(d){var u=d.numFailures,p=d.failures;if(u===0)return a?d.results:d.lastResult;throw new We("".concat(r.name,".bulkPut(): ").concat(u," of ").concat(c," operations failed"),p)})})},J.prototype.bulkUpdate=function(e){var t=this,n=this.core,r=e.map(function(i){return i.key}),o=e.map(function(i){return i.changes}),a=[];return this._trans("readwrite",function(i){return n.getMany({trans:i,keys:r,cache:"clone"}).then(function(s){var c=[],v=[],d=(e.forEach(function(u,p){var h=u.key,f=u.changes,l=s[p];if(l){for(var y=0,g=Object.keys(f);y<g.length;y++){var m=g[y],b=f[m];if(m===t.schema.primKey.keyPath){if(U(b,h)!==0)throw new B.Constraint("Cannot update primary key in bulkUpdate()")}else ue(l,m,b)}a.push(p),c.push(h),v.push(l)}}),c.length);return n.mutate({trans:i,type:"put",keys:c,values:v,updates:{keys:r,changeSpecs:o}}).then(function(u){var p=u.numFailures,h=u.failures;if(p===0)return d;for(var f=0,l=Object.keys(h);f<l.length;f++){var y,g=l[f],m=a[Number(g)];m!=null&&(y=h[g],delete h[g],h[m]=y)}throw new We("".concat(t.name,".bulkUpdate(): ").concat(p," of ").concat(d," operations failed"),h)})})})},J.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",function(r){return t.core.mutate({trans:r,type:"delete",keys:e}).then(function(o){return Dt(t,e,o)})}).then(function(r){var o=r.numFailures,a=r.failures;if(o===0)return r.lastResult;throw new We("".concat(t.name,".bulkDelete(): ").concat(o," of ").concat(n," operations failed"),a)})};var ir=J;function J(){}function dt(e){function t(i,s){if(s){for(var c=arguments.length,v=new Array(c-1);--c;)v[c-1]=arguments[c];return n[i].subscribe.apply(null,v),e}if(typeof i=="string")return n[i]}var n={};t.addEventType=a;for(var r=1,o=arguments.length;r<o;++r)a(arguments[r]);return t;function a(i,s,c){var v,d;if(typeof i!="object")return s=s||Vr,d={subscribers:[],fire:c=c||W,subscribe:function(u){d.subscribers.indexOf(u)===-1&&(d.subscribers.push(u),d.fire=s(d.fire,u))},unsubscribe:function(u){d.subscribers=d.subscribers.filter(function(p){return p!==u}),d.fire=d.subscribers.reduce(s,c)}},n[i]=t[i]=d;E(v=i).forEach(function(u){var p=v[u];if(D(p))a(u,v[u][0],v[u][1]);else{if(p!=="asap")throw new B.InvalidArgument("Invalid event config");var h=a(u,at,function(){for(var f=arguments.length,l=new Array(f);f--;)l[f]=arguments[f];h.subscribers.forEach(function(y){$n(function(){y.apply(null,l)})})})}})}}function ft(e,t){return me(t).from({prototype:e}),t}function Xe(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function fn(e,t){e.filter=Ne(e.filter,t)}function pn(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return Ne(r(),t())}:t,e.justLimit=n&&!r}function Tt(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(n)return n;throw new B.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed")}function sr(e,t,n){var r=Tt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:r,range:e.range}})}function It(e,t,n,r){var o,a,i=e.replayFilter?Ne(e.filter,e.replayFilter()):e.filter;return e.or?(o={},a=function(s,c,v){var d,u;i&&!i(c,v,function(p){return c.stop(p)},function(p){return c.fail(p)})||((u=""+(d=c.primaryKey))=="[object ArrayBuffer]"&&(u=""+new Uint8Array(d)),te(o,u))||(o[u]=!0,t(s,c,v))},Promise.all([e.or._iterate(a,n),ur(sr(e,r,n),e.algorithm,a,!e.keysOnly&&e.valueMapper)])):ur(sr(e,r,n),Ne(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function ur(e,t,n,r){var o=Y(r?function(a,i,s){return n(r(a),i,s)}:n);return e.then(function(a){if(a)return a.start(function(){var i=function(){return a.continue()};t&&!t(a,function(s){return i=s},function(s){a.stop(s),i=W},function(s){a.fail(s),i=W})||o(a.value,a,function(s){return i=s}),i()})})}z.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,Z.bind(null,n.error)):n.table._trans("readonly",e).then(t)},z.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,Z.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},z.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=Ne(t.algorithm,e)},z.prototype._iterate=function(e,t){return It(this._ctx,e,t,this._ctx.table.core)},z.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&L(n,e),t._ctx=n,t},z.prototype.raw=function(){return this._ctx.valueMapper=null,this},z.prototype.each=function(e){var t=this._ctx;return this._read(function(n){return It(t,e,n,t.table.core)})},z.prototype.count=function(e){var t=this;return this._read(function(n){var r,o=t._ctx,a=o.table.core;return Xe(o,!0)?a.count({trans:n,query:{index:Tt(o,a.schema),range:o.range}}).then(function(i){return Math.min(i,o.limit)}):(r=0,It(o,function(){return++r,!1},n,a).then(function(){return r}))}).then(e)},z.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),r=n[0],o=n.length-1;function a(c,v){return v?a(c[n[v]],v-1):c[r]}var i=this._ctx.dir==="next"?1:-1;function s(c,v){return U(a(c,o),a(v,o))*i}return this.toArray(function(c){return c.sort(s)}).then(t)},z.prototype.toArray=function(e){var t=this;return this._read(function(n){var r,o,a,i=t._ctx;return i.dir==="next"&&Xe(i,!0)&&0<i.limit?(r=i.valueMapper,o=Tt(i,i.table.core.schema),i.table.core.query({trans:n,limit:i.limit,values:!0,query:{index:o,range:i.range}}).then(function(s){return s=s.result,r?s.map(r):s})):(a=[],It(i,function(s){return a.push(s)},n,i.table.core).then(function(){return a}))},e)},z.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Xe(t)?pn(t,function(){var n=e;return function(r,o){return n===0||(n===1?--n:o(function(){r.advance(n),n=0}),!1)}}):pn(t,function(){var n=e;return function(){return--n<0}})),this},z.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),pn(this._ctx,function(){var t=e;return function(n,r,o){return--t<=0&&r(o),0<=t}},!0),this},z.prototype.until=function(e,t){return fn(this._ctx,function(n,r,o){return!e(n.value)||(r(o),t)}),this},z.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},z.prototype.last=function(e){return this.reverse().first(e)},z.prototype.filter=function(e){var t;return fn(this._ctx,function(n){return e(n.value)}),(t=this._ctx).isMatch=Ne(t.isMatch,e),this},z.prototype.and=function(e){return this.filter(e)},z.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},z.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},z.prototype.desc=function(){return this.reverse()},z.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,r){e(r.key,r)})},z.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},z.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,r){e(r.primaryKey,r)})},z.prototype.keys=function(e){var t=this._ctx,n=(t.keysOnly=!t.isMatch,[]);return this.each(function(r,o){n.push(o.key)}).then(function(){return n}).then(e)},z.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir==="next"&&Xe(t,!0)&&0<t.limit)return this._read(function(r){var o=Tt(t,t.table.core.schema);return t.table.core.query({trans:r,values:!1,limit:t.limit,query:{index:o,range:t.range}})}).then(function(r){return r.result}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(r,o){n.push(o.primaryKey)}).then(function(){return n}).then(e)},z.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},z.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},z.prototype.lastKey=function(e){return this.reverse().firstKey(e)},z.prototype.distinct=function(){var e,t=this._ctx,t=t.index&&t.table.schema.idxByName[t.index];return t&&t.multi&&(e={},fn(this._ctx,function(r){var r=r.primaryKey.toString(),o=te(e,r);return e[r]=!0,!o})),this},z.prototype.modify=function(e){var t=this,n=this._ctx;return this._write(function(r){function o(l,y){var g=y.failures;p+=l-y.numFailures;for(var m=0,b=E(g);m<b.length;m++){var k=b[m];u.push(g[k])}}var a=typeof e=="function"?e:function(l){return ar(l,e)},i=n.table.core,d=i.schema.primaryKey,s=d.outbound,c=d.extractKey,v=200,d=t.db._options.modifyChunkSize,u=(d&&(v=typeof d=="object"?d[i.name]||d["*"]||200:d),[]),p=0,h=[],f=e===lr;return t.clone().primaryKeys().then(function(l){function y(m){var b=Math.min(v,l.length-m),k=l.slice(m,m+b);return(f?Promise.resolve([]):i.getMany({trans:r,keys:k,cache:"immutable"})).then(function(O){var P=[],_=[],T=s?[]:null,K=f?k:[];if(!f)for(var S=0;S<b;++S){var I=O[S],V={value:De(I),primKey:l[m+S]};a.call(V,V.value,V)!==!1&&(V.value==null?K.push(l[m+S]):s||U(c(I),c(V.value))===0?(_.push(V.value),s&&T.push(l[m+S])):(K.push(l[m+S]),P.push(V.value)))}return Promise.resolve(0<P.length&&i.mutate({trans:r,type:"add",values:P}).then(function(H){for(var M in H.failures)K.splice(parseInt(M),1);o(P.length,H)})).then(function(){return(0<_.length||g&&typeof e=="object")&&i.mutate({trans:r,type:"put",keys:T,values:_,criteria:g,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<m}).then(function(H){return o(_.length,H)})}).then(function(){return(0<K.length||g&&f)&&i.mutate({trans:r,type:"delete",keys:K,criteria:g,isAdditionalChunk:0<m}).then(function(H){return Dt(n.table,K,H)}).then(function(H){return o(K.length,H)})}).then(function(){return l.length>m+b&&y(m+v)})})}var g=Xe(n)&&n.limit===1/0&&(typeof e!="function"||f)&&{index:n.index,range:n.range};return y(0).then(function(){if(0<u.length)throw new xt("Error modifying one or more objects",u,p,h);return l.length})})})},z.prototype.delete=function(){var e=this._ctx,t=e.range;return!Xe(e)||e.table.schema.yProps||!e.isPrimKey&&t.type!==3?this.modify(lr):this._write(function(n){var r=e.table.core.schema.primaryKey,o=t;return e.table.core.count({trans:n,query:{index:r,range:o}}).then(function(a){return e.table.core.mutate({trans:n,type:"deleteRange",range:o}).then(function(c){var s=c.failures,c=c.numFailures;if(c)throw new xt("Could not delete some values",Object.keys(s).map(function(v){return s[v]}),a-c);return a-c})})})};var Yr=z;function z(){}var lr=function(e,t){return t.value=null};function Qr(e,t){return e<t?-1:e===t?0:1}function Xr(e,t){return t<e?-1:e===t?0:1}function fe(e,t,n){return e=e instanceof dr?new e.Collection(e):e,e._ctx.error=new(n||TypeError)(t),e}function Ze(e){return new e.Collection(e,function(){return cr("")}).limit(0)}function qt(h,t,n,r){var o,a,i,s,c,v,d,u=n.length;if(!n.every(function(l){return typeof l=="string"}))return fe(h,Zn);function p(l){o=l==="next"?function(g){return g.toUpperCase()}:function(g){return g.toLowerCase()},a=l==="next"?function(g){return g.toLowerCase()}:function(g){return g.toUpperCase()},i=l==="next"?Qr:Xr;var y=n.map(function(g){return{lower:a(g),upper:o(g)}}).sort(function(g,m){return i(g.lower,m.lower)});s=y.map(function(g){return g.upper}),c=y.map(function(g){return g.lower}),d=(v=l)==="next"?"":r}p("next");var h=new h.Collection(h,function(){return Ce(s[0],c[u-1]+r)}),f=(h._ondirectionchange=function(l){p(l)},0);return h._addAlgorithm(function(l,y,g){var m=l.key;if(typeof m=="string"){var b=a(m);if(t(b,c,f))return!0;for(var k=null,O=f;O<u;++O){var P=((_,T,K,S,I,V)=>{for(var H=Math.min(_.length,S.length),M=-1,$=0;$<H;++$){var Q=T[$];if(Q!==S[$])return I(_[$],K[$])<0?_.substr(0,$)+K[$]+K.substr($+1):I(_[$],S[$])<0?_.substr(0,$)+S[$]+K.substr($+1):0<=M?_.substr(0,M)+T[M]+K.substr(M+1):null;I(_[$],Q)<0&&(M=$)}return H<S.length&&V==="next"?_+K.substr(_.length):H<_.length&&V==="prev"?_.substr(0,K.length):M<0?null:_.substr(0,M)+S[M]+K.substr(M+1)})(m,b,s[O],c[O],i,v);P===null&&k===null?f=O+1:(k===null||0<i(k,P))&&(k=P)}y(k!==null?function(){l.continue(k+d)}:g)}return!1}),h}function Ce(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function cr(e){return{type:1,lower:e,upper:e}}Object.defineProperty(re.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),re.prototype.between=function(e,t,n,r){n=n!==!1,r=r===!0;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(n||r)&&(!n||!r)?Ze(this):new this.Collection(this,function(){return Ce(e,t,!n,!r)})}catch{return fe(this,_e)}},re.prototype.equals=function(e){return e==null?fe(this,_e):new this.Collection(this,function(){return cr(e)})},re.prototype.above=function(e){return e==null?fe(this,_e):new this.Collection(this,function(){return Ce(e,void 0,!0)})},re.prototype.aboveOrEqual=function(e){return e==null?fe(this,_e):new this.Collection(this,function(){return Ce(e,void 0,!1)})},re.prototype.below=function(e){return e==null?fe(this,_e):new this.Collection(this,function(){return Ce(void 0,e,!1,!0)})},re.prototype.belowOrEqual=function(e){return e==null?fe(this,_e):new this.Collection(this,function(){return Ce(void 0,e)})},re.prototype.startsWith=function(e){return typeof e!="string"?fe(this,Zn):this.between(e,e+Le,!0,!0)},re.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):qt(this,function(t,n){return t.indexOf(n[0])===0},[e],Le)},re.prototype.equalsIgnoreCase=function(e){return qt(this,function(t,n){return t===n[0]},[e],"")},re.prototype.anyOfIgnoreCase=function(){var e=xe.apply(ze,arguments);return e.length===0?Ze(this):qt(this,function(t,n){return n.indexOf(t)!==-1},e,"")},re.prototype.startsWithAnyOfIgnoreCase=function(){var e=xe.apply(ze,arguments);return e.length===0?Ze(this):qt(this,function(t,n){return n.some(function(r){return t.indexOf(r)===0})},e,Le)},re.prototype.anyOf=function(){var e,t,n=this,r=xe.apply(ze,arguments),o=this._cmp;try{r.sort(o)}catch{return fe(this,_e)}return r.length===0?Ze(this):((e=new this.Collection(this,function(){return Ce(r[0],r[r.length-1])}))._ondirectionchange=function(a){o=a==="next"?n._ascending:n._descending,r.sort(o)},t=0,e._addAlgorithm(function(a,i,s){for(var c=a.key;0<o(c,r[t]);)if(++t===r.length)return i(s),!1;return o(c,r[t])===0||(i(function(){a.continue(r[t])}),!1)}),e)},re.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},re.prototype.noneOf=function(){var e=xe.apply(ze,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return fe(this,_e)}var t=e.reduce(function(n,r){return n?n.concat([[n[n.length-1][1],r]]):[[-1/0,r]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},re.prototype.inAnyRange=function(e,g){var n=this,r=this._cmp,o=this._ascending,a=this._descending,i=this._min,s=this._max;if(e.length===0)return Ze(this);if(!e.every(function(m){return m[0]!==void 0&&m[1]!==void 0&&o(m[0],m[1])<=0}))return fe(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",B.InvalidArgument);var c=!g||g.includeLowers!==!1,v=g&&g.includeUppers===!0,d,u=o;function p(m,b){return u(m[0],b[0])}try{(d=e.reduce(function(m,b){for(var k=0,O=m.length;k<O;++k){var P=m[k];if(r(b[0],P[1])<0&&0<r(b[1],P[0])){P[0]=i(P[0],b[0]),P[1]=s(P[1],b[1]);break}}return k===O&&m.push(b),m},[])).sort(p)}catch{return fe(this,_e)}var h=0,f=v?function(m){return 0<o(m,d[h][1])}:function(m){return 0<=o(m,d[h][1])},l=c?function(m){return 0<a(m,d[h][0])}:function(m){return 0<=a(m,d[h][0])},y=f,g=new this.Collection(this,function(){return Ce(d[0][0],d[d.length-1][1],!c,!v)});return g._ondirectionchange=function(m){u=m==="next"?(y=f,o):(y=l,a),d.sort(p)},g._addAlgorithm(function(m,b,k){for(var O,P=m.key;y(P);)if(++h===d.length)return b(k),!1;return!f(O=P)&&!l(O)||(n._cmp(P,d[h][1])===0||n._cmp(P,d[h][0])===0||b(function(){u===o?m.continue(d[h][0]):m.continue(d[h][1])}),!1)}),g},re.prototype.startsWithAnyOf=function(){var e=xe.apply(ze,arguments);return e.every(function(t){return typeof t=="string"})?e.length===0?Ze(this):this.inAnyRange(e.map(function(t){return[t,t+Le]})):fe(this,"startsWithAnyOf() only works with strings")};var dr=re;function re(){}function ye(e){return Y(function(t){return pt(t),e(t.target.error),!1})}function pt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var ht="storagemutated",hn="x-storagemutated-1",je=dt(null,ht),Zr=(ge.prototype._lock=function(){return rt(!R.global),++this._reculock,this._reculock!==1||R.global||(R.lockOwnerFor=this),this},ge.prototype._unlock=function(){if(rt(!R.global),--this._reculock==0)for(R.global||(R.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{Me(e[1],e[0])}catch{}}return this},ge.prototype._locked=function(){return this._reculock&&R.lockOwnerFor!==this},ge.prototype.create=function(e){var t=this;if(this.mode){var n=this.db.idbdb,r=this.db._state.dbOpenError;if(rt(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new B.DatabaseClosed(r);case"MissingAPIError":throw new B.MissingAPI(r.message,r);default:throw new B.OpenFailed(r)}if(!this.active)throw new B.TransactionInactive;rt(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Y(function(o){pt(o),t._reject(e.error)}),e.onabort=Y(function(o){pt(o),t.active&&t._reject(new B.Abort(e.error)),t.active=!1,t.on("abort").fire(o)}),e.oncomplete=Y(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&je.storagemutated.fire(e.mutatedParts)})}return this},ge.prototype._promise=function(e,t,n){var r,o=this;return e==="readwrite"&&this.mode!=="readwrite"?Z(new B.ReadOnly("Transaction is readonly")):this.active?this._locked()?new j(function(a,i){o._blockedFuncs.push([function(){o._promise(e,t,n).then(a,i)},R])}):n?Oe(function(){var a=new j(function(i,s){o._lock();var c=t(i,s,o);c&&c.then&&c.then(i,s)});return a.finally(function(){return o._unlock()}),a._lib=!0,a}):((r=new j(function(a,i){var s=t(a,i,o);s&&s.then&&s.then(a,i)}))._lib=!0,r):Z(new B.TransactionInactive)},ge.prototype._root=function(){return this.parent?this.parent._root():this},ge.prototype.waitFor=function(e){var t,n=this._root(),r=j.resolve(e),o=(n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return r}):(n._waitingFor=r,n._waitingQueue=[],t=n.idbtrans.objectStore(n.storeNames[0]),function a(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(t.get(-1/0).onsuccess=a)}()),n._waitingFor);return new j(function(a,i){r.then(function(s){return n._waitingQueue.push(Y(a.bind(null,s)))},function(s){return n._waitingQueue.push(Y(i.bind(null,s)))}).finally(function(){n._waitingFor===o&&(n._waitingFor=null)})})},ge.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new B.Abort))},ge.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(te(t,e))return t[e];var n=this.schema[e];if(n)return(n=new this.db.Table(e,n,this)).core=this.db.core.table(e),t[e]=n;throw new B.NotFound("Table "+e+" not part of transaction")},ge);function ge(){}function mn(e,t,n,r,o,a,i,s){return{name:e,keyPath:t,unique:n,multi:r,auto:o,compound:a,src:(n&&!i?"&":"")+(r?"*":"")+(o?"++":"")+fr(t),type:s}}function fr(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function vn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:(r=function(o){return[o.name,o]},n.reduce(function(o,a,i){return a=r(a,i),a&&(o[a[0]]=a[1]),o},{}))};var r}var mt=function(e){try{return e.only([[]]),mt=function(){return[[]]},[[]]}catch{return mt=function(){return Le},Le}};function yn(e){return e==null?function(){}:typeof e=="string"?(t=e).split(".").length===1?function(n){return n[t]}:function(n){return we(n,t)}:function(n){return we(n,e)};var t}function pr(e){return[].slice.call(e)}var eo=0;function vt(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function to(e,t,c){function r(f){if(f.type===3)return null;if(f.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var u=f.lower,p=f.upper,h=f.lowerOpen,f=f.upperOpen;return u===void 0?p===void 0?null:t.upperBound(p,!!f):p===void 0?t.lowerBound(u,!!h):t.bound(u,p,!!h,!!f)}function o(d){var u,p=d.name;return{name:p,schema:d,mutate:function(h){var f=h.trans,l=h.type,y=h.keys,g=h.values,m=h.range;return new Promise(function(b,k){b=Y(b);var O=f.objectStore(p),P=O.keyPath==null,_=l==="put"||l==="add";if(!_&&l!=="delete"&&l!=="deleteRange")throw new Error("Invalid operation type: "+l);var T,K=(y||g||{length:1}).length;if(y&&g&&y.length!==g.length)throw new Error("Given keys array must have same length as given values array.");if(K===0)return b({numFailures:0,failures:{},results:[],lastResult:void 0});function S(X){++H,pt(X)}var I=[],V=[],H=0;if(l==="deleteRange"){if(m.type===4)return b({numFailures:H,failures:V,results:[],lastResult:void 0});m.type===3?I.push(T=O.clear()):I.push(T=O.delete(r(m)))}else{var P=_?P?[g,y]:[g,null]:[y,null],M=P[0],$=P[1];if(_)for(var Q=0;Q<K;++Q)I.push(T=$&&$[Q]!==void 0?O[l](M[Q],$[Q]):O[l](M[Q])),T.onerror=S;else for(Q=0;Q<K;++Q)I.push(T=O[l](M[Q])),T.onerror=S}function pe(X){X=X.target.result,I.forEach(function(Ue,qn){return Ue.error!=null&&(V[qn]=Ue.error)}),b({numFailures:H,failures:V,results:l==="delete"?y:I.map(function(Ue){return Ue.result}),lastResult:X})}T.onerror=function(X){S(X),pe(X)},T.onsuccess=pe})},getMany:function(h){var f=h.trans,l=h.keys;return new Promise(function(y,g){y=Y(y);for(var m,b=f.objectStore(p),k=l.length,O=new Array(k),P=0,_=0,T=function(I){I=I.target,O[I._pos]=I.result,++_===P&&y(O)},K=ye(g),S=0;S<k;++S)l[S]!=null&&((m=b.get(l[S]))._pos=S,m.onsuccess=T,m.onerror=K,++P);P===0&&y(O)})},get:function(h){var f=h.trans,l=h.key;return new Promise(function(y,g){y=Y(y);var m=f.objectStore(p).get(l);m.onsuccess=function(b){return y(b.target.result)},m.onerror=ye(g)})},query:(u=s,function(h){return new Promise(function(f,l){f=Y(f);var y,g,m,_=h.trans,b=h.values,k=h.limit,P=h.query,O=k===1/0?void 0:k,T=P.index,P=P.range,_=_.objectStore(p),_=T.isPrimaryKey?_:_.index(T.name),T=r(P);if(k===0)return f({result:[]});u?((P=b?_.getAll(T,O):_.getAllKeys(T,O)).onsuccess=function(K){return f({result:K.target.result})},P.onerror=ye(l)):(y=0,g=!b&&"openKeyCursor"in _?_.openKeyCursor(T):_.openCursor(T),m=[],g.onsuccess=function(K){var S=g.result;return!S||(m.push(b?S.value:S.primaryKey),++y===k)?f({result:m}):void S.continue()},g.onerror=ye(l))})}),openCursor:function(h){var f=h.trans,l=h.values,y=h.query,g=h.reverse,m=h.unique;return new Promise(function(b,k){b=Y(b);var _=y.index,O=y.range,P=f.objectStore(p),P=_.isPrimaryKey?P:P.index(_.name),_=g?m?"prevunique":"prev":m?"nextunique":"next",T=!l&&"openKeyCursor"in P?P.openKeyCursor(r(O),_):P.openCursor(r(O),_);T.onerror=ye(k),T.onsuccess=Y(function(K){var S,I,V,H,M=T.result;M?(M.___id=++eo,M.done=!1,S=M.continue.bind(M),I=(I=M.continuePrimaryKey)&&I.bind(M),V=M.advance.bind(M),H=function(){throw new Error("Cursor not stopped")},M.trans=f,M.stop=M.continue=M.continuePrimaryKey=M.advance=function(){throw new Error("Cursor not started")},M.fail=Y(k),M.next=function(){var $=this,Q=1;return this.start(function(){return Q--?$.continue():$.stop()}).then(function(){return $})},M.start=function($){function Q(){if(T.result)try{$()}catch(X){M.fail(X)}else M.done=!0,M.start=function(){throw new Error("Cursor behind last entry")},M.stop()}var pe=new Promise(function(X,Ue){X=Y(X),T.onerror=ye(Ue),M.fail=Ue,M.stop=function(qn){M.stop=M.continue=M.continuePrimaryKey=M.advance=H,X(qn)}});return T.onsuccess=Y(function(X){T.onsuccess=Q,Q()}),M.continue=S,M.continuePrimaryKey=I,M.advance=V,Q(),pe},b(M)):b(null)},k)})},count:function(h){var f=h.query,l=h.trans,y=f.index,g=f.range;return new Promise(function(m,b){var k=l.objectStore(p),k=y.isPrimaryKey?k:k.index(y.name),O=r(g),O=O?k.count(O):k.count();O.onsuccess=Y(function(P){return m(P.target.result)}),O.onerror=ye(b)})}}}a=c,i=pr((c=e).objectStoreNames);var a,c={schema:{name:c.name,tables:i.map(function(d){return a.objectStore(d)}).map(function(d){var u=d.keyPath,p=d.autoIncrement,f=D(u),h={},f={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:u==null,compound:f,keyPath:u,autoIncrement:p,unique:!0,extractKey:yn(u)},indexes:pr(d.indexNames).map(function(l){return d.index(l)}).map(function(m){var b=m.name,y=m.unique,g=m.multiEntry,m=m.keyPath,b={name:b,compound:D(m),keyPath:m,unique:y,multiEntry:g,extractKey:yn(m)};return h[vt(m)]=b}),getIndexByKeyPath:function(l){return h[vt(l)]}};return h[":id"]=f.primaryKey,u!=null&&(h[vt(u)]=f.primaryKey),f})},hasGetAll:0<i.length&&"getAll"in a.objectStore(i[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},i=c.schema,s=c.hasGetAll,c=i.tables.map(o),v={};return c.forEach(function(d){return v[d.name]=d}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(d){if(v[d])return v[d];throw new Error("Table '".concat(d,"' not found"))},MIN_KEY:-1/0,MAX_KEY:mt(t),schema:i}}function no(e,t,n,r){return n=n.IDBKeyRange,t=to(t,n,r),{dbcore:e.dbcore.reduce(function(o,a){return a=a.create,x(x({},o),a(o))},t)}}function Rt(e,t){var n=t.db,n=no(e._middlewares,n,e._deps,t);e.core=n.dbcore,e.tables.forEach(function(r){var o=r.name;e.core.schema.tables.some(function(a){return a.name===o})&&(r.core=e.core.table(o),e[o]instanceof e.Table)&&(e[o].core=r.core)})}function Bt(e,t,n,r){n.forEach(function(o){var a=r[o];t.forEach(function(i){var s=function c(v,d){return Ve(v,d)||(v=G(v))&&c(v,d)}(i,o);(!s||"value"in s&&s.value===void 0)&&(i===e.Transaction.prototype||i instanceof e.Transaction?ce(i,o,{get:function(){return this.table(o)},set:function(c){se(this,o,{value:c,writable:!0,configurable:!0,enumerable:!0})}}):i[o]=new e.Table(o,a))})})}function gn(e,t){t.forEach(function(n){for(var r in n)n[r]instanceof e.Table&&delete n[r]})}function ro(e,t){return e._cfg.version-t._cfg.version}function oo(e,t,n,r){var o=e._dbSchema,a=(n.objectStoreNames.contains("$meta")&&!o.$meta&&(o.$meta=vn("$meta",mr("")[0],[]),e._storeNames.push("$meta")),e._createTransaction("readwrite",e._storeNames,o)),i=(a.create(n),a._completion.catch(r),a._reject.bind(a)),s=R.transless||R;Oe(function(){if(R.trans=a,R.transless=s,t!==0)return Rt(e,n),v=t,((c=a).storeNames.includes("$meta")?c.table("$meta").get("version").then(function(d){return d??v}):j.resolve(v)).then(function(y){var u=e,p=y,h=a,f=n,l=[],y=u._versions,g=u._dbSchema=Lt(0,u.idbdb,f);return(y=y.filter(function(m){return m._cfg.version>=p})).length===0?j.resolve():(y.forEach(function(m){l.push(function(){var b,k,O,P=g,_=m._cfg.dbschema,T=(Nt(u,P,f),Nt(u,_,f),g=u._dbSchema=_,bn(P,_)),K=(T.add.forEach(function(S){wn(f,S[0],S[1].primKey,S[1].indexes)}),T.change.forEach(function(S){if(S.recreate)throw new B.Upgrade("Not yet support for changing primary key");var I=f.objectStore(S.name);S.add.forEach(function(V){return Mt(I,V)}),S.change.forEach(function(V){I.deleteIndex(V.name),Mt(I,V)}),S.del.forEach(function(V){return I.deleteIndex(V)})}),m._cfg.contentUpgrade);if(K&&m._cfg.version>p)return Rt(u,f),h._memoizedTables={},b=Fn(_),T.del.forEach(function(S){b[S]=P[S]}),gn(u,[u.Transaction.prototype]),Bt(u,[u.Transaction.prototype],E(b),b),h.schema=b,(k=Xt(K))&&Ye(),_=j.follow(function(){var S;(O=K(h))&&k&&(S=Pe.bind(null,null),O.then(S,S))}),O&&typeof O.then=="function"?j.resolve(O):_.then(function(){return O})}),l.push(function(b){var k,O,P=m._cfg.dbschema;k=P,O=b,[].slice.call(O.db.objectStoreNames).forEach(function(_){return k[_]==null&&O.db.deleteObjectStore(_)}),gn(u,[u.Transaction.prototype]),Bt(u,[u.Transaction.prototype],u._storeNames,u._dbSchema),h.schema=u._dbSchema}),l.push(function(b){u.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(u.idbdb.version/10)===m._cfg.version?(u.idbdb.deleteObjectStore("$meta"),delete u._dbSchema.$meta,u._storeNames=u._storeNames.filter(function(k){return k!=="$meta"})):b.objectStore("$meta").put(m._cfg.version,"version"))})}),function m(){return l.length?j.resolve(l.shift()(h.idbtrans)).then(m):j.resolve()}().then(function(){hr(g,f)}))}).catch(i);var c,v;E(o).forEach(function(d){wn(n,d,o[d].primKey,o[d].indexes)}),Rt(e,n),j.follow(function(){return e.on.populate.fire(a)}).catch(i)})}function ao(e,t){hr(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=Lt(0,e.idbdb,t);Nt(e,e._dbSchema,t);for(var r=0,o=bn(n,e._dbSchema).change;r<o.length;r++){var a=(i=>{if(i.change.length||i.recreate)return console.warn("Unable to patch indexes of table ".concat(i.name," because it has changes on the type of index or primary key.")),{value:void 0};var s=t.objectStore(i.name);i.add.forEach(function(c){ve&&console.debug("Dexie upgrade patch: Creating missing index ".concat(i.name,".").concat(c.src)),Mt(s,c)})})(o[r]);if(typeof a=="object")return a.value}}function bn(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var o=e[n],a=t[n];if(o){var i={name:n,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(o.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||o.primKey.auto!==a.primKey.auto)i.recreate=!0,r.change.push(i);else{var s=o.idxByName,c=a.idxByName,v=void 0;for(v in s)c[v]||i.del.push(v);for(v in c){var d=s[v],u=c[v];d?d.src!==u.src&&i.change.push(u):i.add.push(u)}(0<i.del.length||0<i.add.length||0<i.change.length)&&r.change.push(i)}}else r.add.push([n,a])}return r}function wn(e,t,n,r){var o=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});r.forEach(function(a){return Mt(o,a)})}function hr(e,t){E(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(ve&&console.debug("Dexie: Creating missing table",n),wn(t,n,e[n].primKey,e[n].indexes))})}function Mt(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Lt(e,t,n){var r={};return wt(t.objectStoreNames,0).forEach(function(o){for(var a=n.objectStore(o),i=mn(fr(v=a.keyPath),v||"",!0,!1,!!a.autoIncrement,v&&typeof v!="string",!0),s=[],c=0;c<a.indexNames.length;++c){var d=a.index(a.indexNames[c]),v=d.keyPath,d=mn(d.name,v,!!d.unique,!!d.multiEntry,!1,v&&typeof v!="string",!1);s.push(d)}r[o]=vn(o,i,s)}),r}function Nt(e,t,n){for(var r=n.db.objectStoreNames,o=0;o<r.length;++o){var a=r[o],i=n.objectStore(a);e._hasGetAll="getAll"in i;for(var s=0;s<i.indexNames.length;++s){var c,v=i.indexNames[s],d=i.index(v).keyPath,d=typeof d=="string"?d:"["+wt(d).join("+")+"]";t[a]&&(c=t[a].idxByName[d])&&(c.name=v,delete t[a].idxByName[d],t[a].idxByName[v]=c)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&q.WorkerGlobalScope&&q instanceof q.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function mr(e){return e.split(",").map(function(t,n){var o=t.split(":"),r=(r=o[1])==null?void 0:r.trim(),o=(t=o[0].trim()).replace(/([&*]|\+\+)/g,""),a=/^\[/.test(o)?o.match(/^\[(.*)\]$/)[1].split("+"):o;return mn(o,a||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),D(a),n===0,r)})}et.prototype._createTableSchema=vn,et.prototype._parseIndexSyntax=mr,et.prototype._parseStoresSpec=function(e,t){var n=this;E(e).forEach(function(r){if(e[r]!==null){var o=n._parseIndexSyntax(e[r]),a=o.shift();if(!a)throw new B.Schema("Invalid schema for table "+r+": "+e[r]);if(a.unique=!0,a.multi)throw new B.Schema("Primary key cannot be multiEntry*");o.forEach(function(i){if(i.auto)throw new B.Schema("Only primary key can be marked as autoIncrement (++)");if(!i.keyPath)throw new B.Schema("Index must have a name and cannot be an empty string")}),a=n._createTableSchema(r,a,o),t[r]=a}})},et.prototype.stores=function(n){var t=this.db,n=(this._cfg.storesSource=this._cfg.storesSource?L(this._cfg.storesSource,n):n,t._versions),r={},o={};return n.forEach(function(a){L(r,a._cfg.storesSource),o=a._cfg.dbschema={},a._parseStoresSpec(r,o)}),t._dbSchema=o,gn(t,[t._allTables,t,t.Transaction.prototype]),Bt(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],E(o),o),t._storeNames=E(o),this},et.prototype.upgrade=function(e){return this._cfg.contentUpgrade=en(this._cfg.contentUpgrade||W,e),this};var io=et;function et(){}function xn(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Ee(jt,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function kn(e){return e&&typeof e.databases=="function"}function _n(e){return Oe(function(){return R.letThrough=!0,e()})}function En(e){return!("from"in e)}var ie=function(e,t){var n;if(!this)return n=new ie,e&&"d"in e&&L(n,e),n;L(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function yt(e,t,n){var r=U(t,n);if(!isNaN(r)){if(0<r)throw RangeError();if(En(e))return L(e,{from:t,to:n,d:1});var r=e.l,o=e.r;if(U(n,e.from)<0)return r?yt(r,t,n):e.l={from:t,to:n,d:1,l:null,r:null},yr(e);if(0<U(t,e.to))return o?yt(o,t,n):e.r={from:t,to:n,d:1,l:null,r:null},yr(e);U(t,e.from)<0&&(e.from=t,e.l=null,e.d=o?o.d+1:1),0<U(n,e.to)&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1),t=!e.r,r&&!e.l&&gt(e,r),o&&t&&gt(e,o)}}function gt(e,t){En(t)||function n(r,o){var a=o.from,i=o.l,s=o.r;yt(r,a,o.to),i&&n(r,i),s&&n(r,s)}(e,t)}function vr(e,t){var n=$t(t),r=n.next();if(!r.done)for(var o=r.value,a=$t(e),i=a.next(o.from),s=i.value;!r.done&&!i.done;){if(U(s.from,o.to)<=0&&0<=U(s.to,o.from))return!0;U(o.from,s.from)<0?o=(r=n.next(s.from)).value:s=(i=a.next(o.from)).value}return!1}function $t(e){var t=En(e)?null:{s:0,n:e};return{next:function(n){for(var r=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&U(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||U(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function yr(e){var t,n,r,o=(((o=e.r)==null?void 0:o.d)||0)-(((o=e.l)==null?void 0:o.d)||0),o=1<o?"r":o<-1?"l":"";o&&(t=o=="r"?"l":"r",n=x({},e),r=e[o],e.from=r.from,e.to=r.to,e[o]=r[o],n[o]=r[t],(e[t]=n).d=gr(n)),e.d=gr(e)}function gr(n){var t=n.r,n=n.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function Ft(e,t){return E(t).forEach(function(n){e[n]?gt(e[n],t[n]):e[n]=function r(o){var a,i,s={};for(a in o)te(o,a)&&(i=o[a],s[a]=!i||typeof i!="object"||Vn.has(i.constructor)?i:r(i));return s}(t[n])}),e}function Sn(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&vr(t[n],e[n])})}F(ie.prototype,((de={add:function(e){return gt(this,e),this},addKey:function(e){return yt(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(n){return yt(t,n,n)}),this},hasKey:function(e){var t=$t(this).next(e).value;return t&&U(t.from,e)<=0&&0<=U(t.to,e)}})[Qt]=function(){return $t(this)},de));var $e={},On={},Pn=!1;function Ut(e){Ft(On,e),Pn||(Pn=!0,setTimeout(function(){Pn=!1,An(On,!(On={}))},0))}function An(e,t){t===void 0&&(t=!1);var n=new Set;if(e.all)for(var r=0,o=Object.values($e);r<o.length;r++)br(s=o[r],e,n,t);else for(var a in e){var i,s,a=/^idb\:\/\/(.*)\/(.*)\//.exec(a);a&&(i=a[1],a=a[2],s=$e["idb://".concat(i,"/").concat(a)])&&br(s,e,n,t)}n.forEach(function(c){return c()})}function br(e,t,n,r){for(var o=[],a=0,i=Object.entries(e.queries.query);a<i.length;a++){for(var s=i[a],c=s[0],v=[],d=0,u=s[1];d<u.length;d++){var p=u[d];Sn(t,p.obsSet)?p.subscribers.forEach(function(y){return n.add(y)}):r&&v.push(p)}r&&o.push([c,v])}if(r)for(var h=0,f=o;h<f.length;h++){var l=f[h],c=l[0],v=l[1];e.queries.query[c]=v}}function so(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?Z(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller,o=Math.round(10*e.verno),a=!1;function i(){if(t.openCanceller!==r)throw new B.DatabaseClosed("db.open() was cancelled")}function s(){return new j(function(p,h){if(i(),!n)throw new B.MissingAPI;var f=e.name,l=t.autoSchema||!o?n.open(f):n.open(f,o);if(!l)throw new B.MissingAPI;l.onerror=ye(h),l.onblocked=Y(e._fireOnBlocked),l.onupgradeneeded=Y(function(y){var g;d=l.transaction,t.autoSchema&&!e._options.allowEmptyDB?(l.onerror=pt,d.abort(),l.result.close(),(g=n.deleteDatabase(f)).onsuccess=g.onerror=Y(function(){h(new B.NoSuchDatabase("Database ".concat(f," doesnt exist")))})):(d.onerror=ye(h),g=y.oldVersion>Math.pow(2,62)?0:y.oldVersion,u=g<1,e.idbdb=l.result,a&&ao(e,d),oo(e,g/10,d,h))},h),l.onsuccess=Y(function(){d=null;var y,g,m,b,k,O,P=e.idbdb=l.result,_=wt(P.objectStoreNames);if(0<_.length)try{var T=P.transaction((k=_).length===1?k[0]:k,"readonly");if(t.autoSchema)O=P,b=T,(m=e).verno=O.version/10,b=m._dbSchema=Lt(0,O,b),m._storeNames=wt(O.objectStoreNames,0),Bt(m,[m._allTables],E(b),b);else if(Nt(e,e._dbSchema,T),g=T,((g=bn(Lt(0,(y=e).idbdb,g),y._dbSchema)).add.length||g.change.some(function(K){return K.add.length||K.change.length}))&&!a)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),P.close(),o=P.version+1,a=!0,p(s());Rt(e,T)}catch{}Qe.push(e),P.onversionchange=Y(function(K){t.vcFired=!0,e.on("versionchange").fire(K)}),P.onclose=Y(function(){e.close({disableAutoOpen:!1})}),u&&(_=e._deps,k=f,kn(O=_.indexedDB)||k===jt||xn(O,_.IDBKeyRange).put({name:k}).catch(W)),p()},h)}).catch(function(p){switch(p==null?void 0:p.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),s();break;case"VersionError":if(0<o)return o=0,s()}return j.reject(p)})}var c,v=t.dbReadyResolve,d=null,u=!1;return j.race([r,(typeof navigator>"u"?j.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(p){function h(){return indexedDB.databases().finally(p)}c=setInterval(h,100),h()}).finally(function(){return clearInterval(c)}):Promise.resolve()).then(s)]).then(function(){return i(),t.onReadyBeingFired=[],j.resolve(_n(function(){return e.on.ready.fire(e.vip)})).then(function p(){var h;if(0<t.onReadyBeingFired.length)return h=t.onReadyBeingFired.reduce(en,W),t.onReadyBeingFired=[],j.resolve(_n(function(){return h(e.vip)})).then(p)})}).finally(function(){t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(p){t.dbOpenError=p;try{d&&d.abort()}catch{}return r===t.openCanceller&&e._close(),Z(p)}).finally(function(){t.openComplete=!0,v()}).then(function(){var p;return u&&(p={},e.tables.forEach(function(h){h.schema.indexes.forEach(function(f){f.name&&(p["idb://".concat(e.name,"/").concat(h.name,"/").concat(f.name)]=new ie(-1/0,[[[]]]))}),p["idb://".concat(e.name,"/").concat(h.name,"/")]=p["idb://".concat(e.name,"/").concat(h.name,"/:dels")]=new ie(-1/0,[[[]]])}),je(ht).fire(p),An(p,!0)),e})}function Cn(e){function t(a){return e.next(a)}var n=o(t),r=o(function(a){return e.throw(a)});function o(a){return function(s){var s=a(s),c=s.value;return s.done?c:c&&typeof c.then=="function"?c.then(n,r):D(c)?Promise.all(c).then(n,r):n(c)}}return o(t)()}function Vt(e,t,n){for(var r=D(e)?e.slice():[e],o=0;o<n;++o)r.push(t);return r}var uo={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return x(x({},e),{table:function(r){var n=e.table(r),r=n.schema,o={},a=[];function i(p,h,f){var m=vt(p),l=o[m]=o[m]||[],y=p==null?0:typeof p=="string"?1:p.length,g=0<h,m=x(x({},f),{name:g?"".concat(m,"(virtual-from:").concat(f.name,")"):f.name,lowLevelIndex:f,isVirtual:g,keyTail:h,keyLength:y,extractKey:yn(p),unique:!g&&f.unique});return l.push(m),m.isPrimaryKey||a.push(m),1<y&&i(y===2?p[0]:p.slice(0,y-1),h+1,f),l.sort(function(b,k){return b.keyTail-k.keyTail}),m}var s=i(r.primaryKey.keyPath,0,r.primaryKey);o[":id"]=[s];for(var c=0,v=r.indexes;c<v.length;c++){var d=v[c];i(d.keyPath,0,d)}function u(p){var h,f=p.query.index;return f.isVirtual?x(x({},p),{query:{index:f.lowLevelIndex,range:(h=p.query.range,f=f.keyTail,{type:h.type===1?2:h.type,lower:Vt(h.lower,h.lowerOpen?e.MAX_KEY:e.MIN_KEY,f),lowerOpen:!0,upper:Vt(h.upper,h.upperOpen?e.MIN_KEY:e.MAX_KEY,f),upperOpen:!0})}}):p}return x(x({},n),{schema:x(x({},r),{primaryKey:s,indexes:a,getIndexByKeyPath:function(p){return(p=o[vt(p)])&&p[0]}}),count:function(p){return n.count(u(p))},query:function(p){return n.query(u(p))},openCursor:function(p){var h=p.query.index,f=h.keyTail,l=h.keyLength;return h.isVirtual?n.openCursor(u(p)).then(function(g){return g&&y(g)}):n.openCursor(p);function y(g){return Object.create(g,{continue:{value:function(m){m!=null?g.continue(Vt(m,p.reverse?e.MAX_KEY:e.MIN_KEY,f)):p.unique?g.continue(g.key.slice(0,l).concat(p.reverse?e.MIN_KEY:e.MAX_KEY,f)):g.continue()}},continuePrimaryKey:{value:function(m,b){g.continuePrimaryKey(Vt(m,e.MAX_KEY,f),b)}},primaryKey:{get:function(){return g.primaryKey}},key:{get:function(){var m=g.key;return l===1?m[0]:m.slice(0,l)}},value:{get:function(){return g.value}}})}}})}})}};function jn(e,t,n,r){return n=n||{},r=r||"",E(e).forEach(function(o){var a,i,s;te(t,o)?(a=e[o],i=t[o],typeof a=="object"&&typeof i=="object"&&a&&i?(s=Yt(a))!==Yt(i)?n[r+o]=t[o]:s==="Object"?jn(a,i,n,r+o+"."):a!==i&&(n[r+o]=t[o]):a!==i&&(n[r+o]=t[o])):n[r+o]=void 0}),E(t).forEach(function(o){te(e,o)||(n[r+o]=t[o])}),n}function Kn(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var lo={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return x(x({},e),{table:function(t){var n=e.table(t),r=n.schema.primaryKey;return x(x({},n),{mutate:function(o){var a=R.trans,i=a.table(t).hook,s=i.deleting,c=i.creating,v=i.updating;switch(o.type){case"add":if(c.fire===W)break;return a._promise("readwrite",function(){return d(o)},!0);case"put":if(c.fire===W&&v.fire===W)break;return a._promise("readwrite",function(){return d(o)},!0);case"delete":if(s.fire===W)break;return a._promise("readwrite",function(){return d(o)},!0);case"deleteRange":if(s.fire===W)break;return a._promise("readwrite",function(){return function u(p,h,f){return n.query({trans:p,values:!1,query:{index:r,range:h},limit:f}).then(function(l){var y=l.result;return d({type:"delete",keys:y,trans:p}).then(function(g){return 0<g.numFailures?Promise.reject(g.failures[0]):y.length<f?{failures:[],numFailures:0,lastResult:void 0}:u(p,x(x({},h),{lower:y[y.length-1],lowerOpen:!0}),f)})})}(o.trans,o.range,1e4)},!0)}return n.mutate(o);function d(u){var p,h,f,l=R.trans,y=u.keys||Kn(r,u);if(y)return(u=u.type==="add"||u.type==="put"?x(x({},u),{keys:y}):x({},u)).type!=="delete"&&(u.values=N([],u.values)),u.keys&&(u.keys=N([],u.keys)),p=n,f=y,((h=u).type==="add"?Promise.resolve([]):p.getMany({trans:h.trans,keys:f,cache:"immutable"})).then(function(g){var m=y.map(function(b,k){var O,P,_,T=g[k],K={onerror:null,onsuccess:null};return u.type==="delete"?s.fire.call(K,b,T,l):u.type==="add"||T===void 0?(O=c.fire.call(K,b,u.values[k],l),b==null&&O!=null&&(u.keys[k]=b=O,r.outbound||ue(u.values[k],r.keyPath,b))):(O=jn(T,u.values[k]),(P=v.fire.call(K,O,b,T,l))&&(_=u.values[k],Object.keys(P).forEach(function(S){te(_,S)?_[S]=P[S]:ue(_,S,P[S])}))),K});return n.mutate(u).then(function(b){for(var k=b.failures,O=b.results,P=b.numFailures,b=b.lastResult,_=0;_<y.length;++_){var T=(O||y)[_],K=m[_];T==null?K.onerror&&K.onerror(k[_]):K.onsuccess&&K.onsuccess(u.type==="put"&&g[_]?u.values[_]:T)}return{failures:k,results:O,numFailures:P,lastResult:b}}).catch(function(b){return m.forEach(function(k){return k.onerror&&k.onerror(b)}),Promise.reject(b)})});throw new Error("Keys missing")}}})}})}};function wr(e,t,n){try{if(!t||t.keys.length<e.length)return null;for(var r=[],o=0,a=0;o<t.keys.length&&a<e.length;++o)U(t.keys[o],e[a])===0&&(r.push(n?De(t.values[o]):t.values[o]),++a);return r.length===e.length?r:null}catch{return null}}var co={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return x(x({},n),{getMany:function(r){var o;return r.cache?(o=wr(r.keys,r.trans._cache,r.cache==="clone"))?j.resolve(o):n.getMany(r).then(function(a){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?De(a):a},a}):n.getMany(r)},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}};function xr(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function kr(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var fo={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,n=new ie(e.MIN_KEY,e.MAX_KEY);return x(x({},e),{transaction:function(r,o,a){if(R.subscr&&o!=="readonly")throw new B.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(R.querier));return e.transaction(r,o,a)},table:function(r){function o(y){var l,y=y.query;return[l=y.index,new ie((l=(y=y.range).lower)!=null?l:e.MIN_KEY,(l=y.upper)!=null?l:e.MAX_KEY)]}var a=e.table(r),i=a.schema,s=i.primaryKey,c=i.indexes,v=s.extractKey,d=s.outbound,u=s.autoIncrement&&c.filter(function(f){return f.compound&&f.keyPath.includes(s.keyPath)}),p=x(x({},a),{mutate:function(f){function l(I){return I="idb://".concat(t,"/").concat(r,"/").concat(I),k[I]||(k[I]=new ie)}var y,g,m,b=f.trans,k=f.mutatedParts||(f.mutatedParts={}),O=l(""),P=l(":dels"),_=f.type,K=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[Kn(s,f).filter(function(I){return I}),f.values]:[],T=K[0],K=K[1],S=f.trans._cache;return D(T)?(O.addKeys(T),(_=_==="delete"||T.length===K.length?wr(T,S):null)||P.addKeys(T),(_||K)&&(y=l,g=_,m=K,i.indexes.forEach(function(I){var V=y(I.name||"");function H($){return $!=null?I.extractKey($):null}function M($){I.multiEntry&&D($)?$.forEach(function(Q){return V.addKey(Q)}):V.addKey($)}(g||m).forEach(function($,X){var pe=g&&H(g[X]),X=m&&H(m[X]);U(pe,X)!==0&&(pe!=null&&M(pe),X!=null)&&M(X)})}))):T?(K={from:(S=T.lower)!=null?S:e.MIN_KEY,to:(_=T.upper)!=null?_:e.MAX_KEY},P.add(K),O.add(K)):(O.add(n),P.add(n),i.indexes.forEach(function(I){return l(I.name).add(n)})),a.mutate(f).then(function(I){return!T||f.type!=="add"&&f.type!=="put"||(O.addKeys(I.results),u&&u.forEach(function(V){for(var H=f.values.map(function(pe){return V.extractKey(pe)}),M=V.keyPath.findIndex(function(pe){return pe===s.keyPath}),$=0,Q=I.results.length;$<Q;++$)H[$][M]=I.results[$];l(V.name).addKeys(H)})),b.mutatedParts=Ft(b.mutatedParts||{},k),I})}}),h={get:function(f){return[s,new ie(f.key)]},getMany:function(f){return[s,new ie().addKeys(f.keys)]},count:o,query:o,openCursor:o};return E(h).forEach(function(f){p[f]=function(l){var y=R.subscr,g=!!y,m=xr(R,a)&&kr(f,l)?l.obsSet={}:y;if(g){var b,y=function(K){return K="idb://".concat(t,"/").concat(r,"/").concat(K),m[K]||(m[K]=new ie)},k=y(""),O=y(":dels"),g=h[f](l),P=g[0],g=g[1];if((f==="query"&&P.isPrimaryKey&&!l.values?O:y(P.name||"")).add(g),!P.isPrimaryKey){if(f!=="count")return b=f==="query"&&d&&l.values&&a.query(x(x({},l),{values:!1})),a[f].apply(this,arguments).then(function(K){if(f==="query"){if(d&&l.values)return b.then(function(H){return H=H.result,k.addKeys(H),K});var S=l.values?K.result.map(v):K.result;(l.values?k:O).addKeys(S)}else{var I,V;if(f==="openCursor")return V=l.values,(I=K)&&Object.create(I,{key:{get:function(){return O.addKey(I.primaryKey),I.key}},primaryKey:{get:function(){var H=I.primaryKey;return O.addKey(H),H}},value:{get:function(){return V&&k.addKey(I.primaryKey),I.value}}})}return K});O.add(n)}}return a[f].apply(this,arguments)}}),p}})}};function _r(e,t,n){var r;return n.numFailures===0?t:t.type==="deleteRange"||(r=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1,n.numFailures===r)?null:(r=x({},t),D(r.keys)&&(r.keys=r.keys.filter(function(o,a){return!(a in n.failures)})),"values"in r&&D(r.values)&&(r.values=r.values.filter(function(o,a){return!(a in n.failures)})),r)}function Dn(e,t){return n=e,((r=t).lower===void 0||(r.lowerOpen?0<U(n,r.lower):0<=U(n,r.lower)))&&(n=e,(r=t).upper===void 0||(r.upperOpen?U(n,r.upper)<0:U(n,r.upper)<=0));var n,r}function Er(e,t,n,r,o,a){var i,s,c,v,d,u;return!n||n.length===0||(i=t.query.index,s=i.multiEntry,c=t.query.range,v=r.schema.primaryKey.extractKey,d=i.extractKey,u=(i.lowLevelIndex||i).extractKey,(r=n.reduce(function(p,h){var f=p,l=[];if(h.type==="add"||h.type==="put")for(var y=new ie,g=h.values.length-1;0<=g;--g){var m,b=h.values[g],k=v(b);!y.hasKey(k)&&(m=d(b),s&&D(m)?m.some(function(K){return Dn(K,c)}):Dn(m,c))&&(y.addKey(k),l.push(b))}switch(h.type){case"add":var O=new ie().addKeys(t.values?p.map(function(S){return v(S)}):p),f=p.concat(t.values?l.filter(function(S){return S=v(S),!O.hasKey(S)&&(O.addKey(S),!0)}):l.map(function(S){return v(S)}).filter(function(S){return!O.hasKey(S)&&(O.addKey(S),!0)}));break;case"put":var P=new ie().addKeys(h.values.map(function(S){return v(S)}));f=p.filter(function(S){return!P.hasKey(t.values?v(S):S)}).concat(t.values?l:l.map(function(S){return v(S)}));break;case"delete":var _=new ie().addKeys(h.keys);f=p.filter(function(S){return!_.hasKey(t.values?v(S):S)});break;case"deleteRange":var T=h.range;f=p.filter(function(S){return!Dn(v(S),T)})}return f},e))===e)?e:(r.sort(function(p,h){return U(u(p),u(h))||U(v(p),v(h))}),t.limit&&t.limit<1/0&&(r.length>t.limit?r.length=t.limit:e.length===t.limit&&r.length<t.limit&&(o.dirty=!0)),a?Object.freeze(r):r)}function Sr(e,t){return U(e.lower,t.lower)===0&&U(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function po(e,t){return((n,r,o,a)=>{if(n===void 0)return r!==void 0?-1:0;if(r===void 0)return 1;if((n=U(n,r))===0){if(o&&a)return 0;if(o)return 1;if(a)return-1}return n})(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=((n,r,o,a)=>{if(n===void 0)return r!==void 0?1:0;if(r===void 0)return-1;if((n=U(n,r))===0){if(o&&a)return 0;if(o)return-1;if(a)return 1}return n})(e.upper,t.upper,e.upperOpen,t.upperOpen)}function ho(e,t,n,r){e.subscribers.add(n),r.addEventListener("abort",function(){var o,a;e.subscribers.delete(n),e.subscribers.size===0&&(o=e,a=t,setTimeout(function(){o.subscribers.size===0&&Te(a,o)},3e3))})}var mo={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return x(x({},e),{transaction:function(n,r,o){var a,i,s=e.transaction(n,r,o);return r==="readwrite"&&(o=(a=new AbortController).signal,s.addEventListener("abort",(i=function(c){return function(){if(a.abort(),r==="readwrite"){for(var v=new Set,d=0,u=n;d<u.length;d++){var p=u[d],h=$e["idb://".concat(t,"/").concat(p)];if(h){var f=e.table(p),l=h.optimisticOps.filter(function(I){return I.trans===s});if(s._explicit&&c&&s.mutatedParts)for(var y=0,g=Object.values(h.queries.query);y<g.length;y++)for(var m=0,b=(P=g[y]).slice();m<b.length;m++)Sn((_=b[m]).obsSet,s.mutatedParts)&&(Te(P,_),_.subscribers.forEach(function(I){return v.add(I)}));else if(0<l.length){h.optimisticOps=h.optimisticOps.filter(function(I){return I.trans!==s});for(var k=0,O=Object.values(h.queries.query);k<O.length;k++)for(var P,_,T,K=0,S=(P=O[k]).slice();K<S.length;K++)(_=S[K]).res!=null&&s.mutatedParts&&(c&&!_.dirty?(T=Object.isFrozen(_.res),T=Er(_.res,_.req,l,f,_,T),_.dirty?(Te(P,_),_.subscribers.forEach(function(I){return v.add(I)})):T!==_.res&&(_.res=T,_.promise=j.resolve({result:T}))):(_.dirty&&Te(P,_),_.subscribers.forEach(function(I){return v.add(I)})))}}}v.forEach(function(I){return I()})}}})(!1),{signal:o}),s.addEventListener("error",i(!1),{signal:o}),s.addEventListener("complete",i(!0),{signal:o})),s},table:function(n){var r=e.table(n),o=r.schema.primaryKey;return x(x({},r),{mutate:function(a){var i,s=R.trans;return!o.outbound&&s.db._options.cache!=="disabled"&&!s.explicit&&s.idbtrans.mode==="readwrite"&&(i=$e["idb://".concat(t,"/").concat(n)])?(s=r.mutate(a),a.type!=="add"&&a.type!=="put"||!(50<=a.values.length||Kn(o,a).some(function(c){return c==null}))?(i.optimisticOps.push(a),a.mutatedParts&&Ut(a.mutatedParts),s.then(function(c){0<c.numFailures&&(Te(i.optimisticOps,a),(c=_r(0,a,c))&&i.optimisticOps.push(c),a.mutatedParts)&&Ut(a.mutatedParts)}),s.catch(function(){Te(i.optimisticOps,a),a.mutatedParts&&Ut(a.mutatedParts)})):s.then(function(c){var v=_r(0,x(x({},a),{values:a.values.map(function(d,u){var p;return c.failures[u]?d:(ue(p=(p=o.keyPath)!=null&&p.includes(".")?De(d):x({},d),o.keyPath,c.results[u]),p)})}),c);i.optimisticOps.push(v),queueMicrotask(function(){return a.mutatedParts&&Ut(a.mutatedParts)})}),s):r.mutate(a)},query:function(a){var i,s,c,v,d,u,p;return xr(R,r)&&kr("query",a)?(i=((c=R.trans)==null?void 0:c.db._options.cache)==="immutable",s=(c=R).requery,c=c.signal,u=((h,f,l,y)=>{var g=$e["idb://".concat(h,"/").concat(f)];if(!g)return[];if(!(h=g.queries[l]))return[null,!1,g,null];var m=h[(y.query?y.query.index.name:null)||""];if(!m)return[null,!1,g,null];switch(l){case"query":var b=m.find(function(k){return k.req.limit===y.limit&&k.req.values===y.values&&Sr(k.req.query.range,y.query.range)});return b?[b,!0,g,m]:[m.find(function(k){return("limit"in k.req?k.req.limit:1/0)>=y.limit&&(!y.values||k.req.values)&&po(k.req.query.range,y.query.range)}),!1,g,m];case"count":return b=m.find(function(k){return Sr(k.req.query.range,y.query.range)}),[b,!!b,g,m]}})(t,n,"query",a),p=u[0],v=u[2],d=u[3],p&&u[1]?p.obsSet=a.obsSet:(u=r.query(a).then(function(h){var f=h.result;if(p&&(p.res=f),i){for(var l=0,y=f.length;l<y;++l)Object.freeze(f[l]);Object.freeze(f)}else h.result=De(f);return h}).catch(function(h){return d&&p&&Te(d,p),Promise.reject(h)}),p={obsSet:a.obsSet,promise:u,subscribers:new Set,type:"query",req:a,dirty:!1},d?d.push(p):(d=[p],(v=v||($e["idb://".concat(t,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[a.query.index.name||""]=d)),ho(p,d,s,c),p.promise.then(function(h){return{result:Er(h.result,a,v==null?void 0:v.optimisticOps,r,p,i)}})):r.query(a)}})}})}};function zt(e,t){return new Proxy(e,{get:function(n,r,o){return r==="db"?t:Reflect.get(n,r,o)}})}ee.prototype.version=function(e){if(isNaN(e)||e<.1)throw new B.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new B.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter(function(r){return r._cfg.version===e})[0];return n||(n=new this.Version(e),t.push(n),t.sort(ro),n.stores({}),this._state.autoSchema=!1),n},ee.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||R.letThrough||this._vip)?e():new j(function(n,r){if(t._state.openComplete)return r(new B.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void r(new B.DatabaseClosed);t.open().catch(W)}t._state.dbReadyPromise.then(n,r)}).then(e)},ee.prototype.use=function(o){var t=o.stack,n=o.create,r=o.level,o=o.name,a=(o&&this.unuse({stack:t,name:o}),this._middlewares[t]||(this._middlewares[t]=[]));return a.push({stack:t,create:n,level:r??10,name:o}),a.sort(function(i,s){return i.level-s.level}),this},ee.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(o){return r?o.create!==r:!!n&&o.name!==n})),this},ee.prototype.open=function(){var e=this;return Me(Se,function(){return so(e)})},ee.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var e=this._state,t=Qe.indexOf(this);if(0<=t&&Qe.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new j(function(n){e.dbReadyResolve=n}),e.openCanceller=new j(function(n,r){e.cancelOpen=r}))},ee.prototype.close=function(t){var t=(t===void 0?{disableAutoOpen:!0}:t).disableAutoOpen,n=this._state;t?(n.isBeingOpened&&n.cancelOpen(new B.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new B.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},ee.prototype.delete=function(e){var t=this,n=(e===void 0&&(e={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),r=this._state;return new j(function(o,a){function i(){t.close(e);var s=t._deps.indexedDB.deleteDatabase(t.name);s.onsuccess=Y(function(){var c,v,d;c=t._deps,v=t.name,kn(d=c.indexedDB)||v===jt||xn(d,c.IDBKeyRange).delete(v).catch(W),o()}),s.onerror=ye(a),s.onblocked=t._fireOnBlocked}if(n)throw new B.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(i):i()})},ee.prototype.backendDB=function(){return this.idbdb},ee.prototype.isOpen=function(){return this.idbdb!==null},ee.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},ee.prototype.hasFailed=function(){return this._state.dbOpenError!==null},ee.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(ee.prototype,"tables",{get:function(){var e=this;return E(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),ee.prototype.transaction=function(){var e=(function(t,n,r){var o=arguments.length;if(o<2)throw new B.InvalidArgument("Too few arguments");for(var a=new Array(o-1);--o;)a[o-1]=arguments[o];return r=a.pop(),[t,Un(a),r]}).apply(this,arguments);return this._transaction.apply(this,e)},ee.prototype._transaction=function(e,t,n){var r,o,a=this,i=R.trans,s=(i&&i.db===this&&e.indexOf("!")===-1||(i=null),e.indexOf("?")!==-1);e=e.replace("!","").replace("?","");try{if(o=t.map(function(v){if(v=v instanceof a.Table?v.name:v,typeof v!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return v}),e=="r"||e===cn)r=cn;else{if(e!="rw"&&e!=dn)throw new B.InvalidArgument("Invalid transaction mode: "+e);r=dn}if(i){if(i.mode===cn&&r===dn){if(!s)throw new B.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&o.forEach(function(v){if(i&&i.storeNames.indexOf(v)===-1){if(!s)throw new B.SubTransaction("Table "+v+" not included in parent transaction.");i=null}}),s&&i&&!i.active&&(i=null)}}catch(v){return i?i._promise(null,function(d,u){u(v)}):Z(v)}var c=(function v(d,u,p,h,f){return j.resolve().then(function(){var m=R.transless||R,l=d._createTransaction(u,p,d._dbSchema,h),m=(l.explicit=!0,{trans:l,transless:m});if(h)l.idbtrans=h.idbtrans;else try{l.create(),l.idbtrans._explicit=!0,d._state.PR1398_maxLoop=3}catch(b){return b.name===Zt.InvalidState&&d.isOpen()&&0<--d._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),d.close({disableAutoOpen:!1}),d.open().then(function(){return v(d,u,p,null,f)})):Z(b)}var y,g=Xt(f),m=(g&&Ye(),j.follow(function(){var b;(y=f.call(l,l))&&(g?(b=Pe.bind(null,null),y.then(b,b)):typeof y.next=="function"&&typeof y.throw=="function"&&(y=Cn(y)))},m));return(y&&typeof y.then=="function"?j.resolve(y).then(function(b){return l.active?b:Z(new B.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):m.then(function(){return y})).then(function(b){return h&&l._resolve(),l._completion.then(function(){return b})}).catch(function(b){return l._reject(b),Z(b)})})}).bind(null,this,r,o,i,n);return i?i._promise(r,c,"lock"):R.trans?Me(R.transless,function(){return a._whenReady(c)}):this._whenReady(c)},ee.prototype.table=function(e){if(te(this._allTables,e))return this._allTables[e];throw new B.InvalidTable("Table ".concat(e," does not exist"))};var Ee=ee;function ee(e,t){var n,r,o,a,i,s=this,c=(this._middlewares={},this.verno=0,ee.dependencies),c=(this._options=t=x({addons:ee.addons,autoOpen:!0,indexedDB:c.indexedDB,IDBKeyRange:c.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},t.addons),v=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:W,dbReadyPromise:null,cancelOpen:W,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen}),d=(v.dbReadyPromise=new j(function(u){v.dbReadyResolve=u}),v.openCanceller=new j(function(u,p){v.cancelOpen=p}),this._state=v,this.name=e,this.on=dt(this,"populate","blocked","versionchange","close",{ready:[en,W]}),this.once=function(u,p){var h=function(){for(var f=[],l=0;l<arguments.length;l++)f[l]=arguments[l];s.on(u).unsubscribe(h),p.apply(s,f)};return s.on(u,h)},this.on.ready.subscribe=Nn(this.on.ready.subscribe,function(u){return function(p,h){ee.vip(function(){var f,l=s._state;l.openComplete?(l.dbOpenError||j.resolve().then(p),h&&u(p)):l.onReadyBeingFired?(l.onReadyBeingFired.push(p),h&&u(p)):(u(p),f=s,h||u(function y(){f.on.ready.unsubscribe(p),f.on.ready.unsubscribe(y)}))})}}),this.Collection=(n=this,ft(Yr.prototype,function(y,l){this.db=n;var h=er,f=null;if(l)try{h=l()}catch(m){f=m}var l=y._ctx,y=l.table,g=y.hook.reading.fire;this._ctx={table:y,index:l.index,isPrimKey:!l.index||y.schema.primKey.keyPath&&l.index===y.schema.primKey.name,range:h,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:f,or:l.or,valueMapper:g!==at?g:null}})),this.Table=(r=this,ft(ir.prototype,function(u,p,h){this.db=r,this._tx=h,this.name=u,this.schema=p,this.hook=r._allTables[u]?r._allTables[u].hook:dt(null,{creating:[$r,W],reading:[Nr,at],updating:[Ur,W],deleting:[Fr,W]})})),this.Transaction=(o=this,ft(Zr.prototype,function(u,p,h,f,l){var y=this;u!=="readonly"&&p.forEach(function(g){g=(g=h[g])==null?void 0:g.yProps,g&&(p=p.concat(g.map(function(m){return m.updatesTable})))}),this.db=o,this.mode=u,this.storeNames=p,this.schema=h,this.chromeTransactionDurability=f,this.idbtrans=null,this.on=dt(this,"complete","error","abort"),this.parent=l||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new j(function(g,m){y._resolve=g,y._reject=m}),this._completion.then(function(){y.active=!1,y.on.complete.fire()},function(g){var m=y.active;return y.active=!1,y.on.error.fire(g),y.parent?y.parent._reject(g):m&&y.idbtrans&&y.idbtrans.abort(),Z(g)})})),this.Version=(a=this,ft(io.prototype,function(u){this.db=a,this._cfg={version:u,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(i=this,ft(dr.prototype,function(u,p,h){if(this.db=i,this._ctx={table:u,index:p===":id"?null:p,or:h},this._cmp=this._ascending=U,this._descending=function(f,l){return U(l,f)},this._max=function(f,l){return 0<U(f,l)?f:l},this._min=function(f,l){return U(f,l)<0?f:l},this._IDBKeyRange=i._deps.IDBKeyRange,!this._IDBKeyRange)throw new B.MissingAPI})),this.on("versionchange",function(u){0<u.newVersion?console.warn("Another connection wants to upgrade database '".concat(s.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(s.name,"'. Closing db now to resume the delete request.")),s.close({disableAutoOpen:!1})}),this.on("blocked",function(u){!u.newVersion||u.newVersion<u.oldVersion?console.warn("Dexie.delete('".concat(s.name,"') was blocked")):console.warn("Upgrade '".concat(s.name,"' blocked by other connection holding version ").concat(u.oldVersion/10))}),this._maxKey=mt(t.IDBKeyRange),this._createTransaction=function(u,p,h,f){return new s.Transaction(u,p,h,s._options.chromeTransactionDurability,f)},this._fireOnBlocked=function(u){s.on("blocked").fire(u),Qe.filter(function(p){return p.name===s.name&&p!==s&&!p._state.vcFired}).map(function(p){return p.on("versionchange").fire(u)})},this.use(co),this.use(mo),this.use(fo),this.use(uo),this.use(lo),new Proxy(this,{get:function(u,p,h){var f;return p==="_vip"||(p==="table"?function(l){return zt(s.table(l),d)}:(f=Reflect.get(u,p,h))instanceof ir?zt(f,d):p==="tables"?f.map(function(l){return zt(l,d)}):p==="_createTransaction"?function(){return zt(f.apply(this,arguments),d)}:f)}}));this.vip=d,c.forEach(function(u){return u(s)})}var Ht,tt=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",vo=(Tn.prototype.subscribe=function(e,t,n){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:n})},Tn.prototype[tt]=function(){return this},Tn);function Tn(e){this._subscribe=e}try{Ht={indexedDB:q.indexedDB||q.mozIndexedDB||q.webkitIndexedDB||q.msIndexedDB,IDBKeyRange:q.IDBKeyRange||q.webkitIDBKeyRange}}catch{Ht={indexedDB:null,IDBKeyRange:null}}function Or(e){var t,n=!1,r=new vo(function(o){var a=Xt(e),i,s=!1,c={},v={},d={get closed(){return s},unsubscribe:function(){s||(s=!0,i&&i.abort(),u&&je.storagemutated.unsubscribe(h))}},u=(o.start&&o.start(d),!1),p=function(){return ln(f)},h=function(l){Ft(c,l),Sn(v,c)&&p()},f=function(){var l,y,g;!s&&Ht.indexedDB&&(c={},l={},i&&i.abort(),i=new AbortController,g=(m=>{var b=Je();try{a&&Ye();var k=Oe(e,m);return k=a?k.finally(Pe):k}finally{b&&Ge()}})(y={subscr:l,signal:i.signal,requery:p,querier:e,trans:null}),Promise.resolve(g).then(function(m){n=!0,t=m,s||y.signal.aborted||(c={},(b=>{for(var k in b)if(te(b,k))return;return 1})(v=l)||u||(je(ht,h),u=!0),ln(function(){return!s&&o.next&&o.next(m)}))},function(m){n=!1,["DatabaseClosedError","AbortError"].includes(m==null?void 0:m.name)||s||ln(function(){s||o.error&&o.error(m)})}))};return setTimeout(p,0),d});return r.hasValue=function(){return n},r.getValue=function(){return t},r}var Fe=Ee;function In(e){var t=Ke;try{Ke=!0,je.storagemutated.fire(e),An(e,!0)}finally{Ke=t}}F(Fe,x(x({},ke),{delete:function(e){return new Fe(e,{addons:[]}).delete()},exists:function(e){return new Fe(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return t=Fe.dependencies,n=t.indexedDB,t=t.IDBKeyRange,(kn(n)?Promise.resolve(n.databases()).then(function(r){return r.map(function(o){return o.name}).filter(function(o){return o!==jt})}):xn(n,t).toCollection().primaryKeys()).then(e)}catch{return Z(new B.MissingAPI)}var t,n},defineClass:function(){return function(e){L(this,e)}},ignoreTransaction:function(e){return R.trans?Me(R.transless,e):e()},vip:_n,async:function(e){return function(){try{var t=Cn(e.apply(this,arguments));return t&&typeof t.then=="function"?t:j.resolve(t)}catch(n){return Z(n)}}},spawn:function(e,t,n){try{var r=Cn(e.apply(n,t||[]));return r&&typeof r.then=="function"?r:j.resolve(r)}catch(o){return Z(o)}},currentTransaction:{get:function(){return R.trans||null}},waitFor:function(e,t){return e=j.resolve(typeof e=="function"?Fe.ignoreTransaction(e):e).timeout(t||6e4),R.trans?R.trans.waitFor(e):e},Promise:j,debug:{get:function(){return ve},set:function(e){Wn(e)}},derive:me,extend:L,props:F,override:Nn,Events:dt,on:je,liveQuery:Or,extendObservabilitySet:Ft,getByKeyPath:we,setByKeyPath:ue,delByKeyPath:function(e,t){typeof t=="string"?ue(e,t,void 0):"length"in t&&[].map.call(t,function(n){ue(e,n,void 0)})},shallowClone:Fn,deepClone:De,getObjectDiff:jn,cmp:U,asap:$n,minKey:-1/0,addons:[],connections:Qe,errnames:Zt,dependencies:Ht,cache:$e,semVer:"4.3.0",version:"4.3.0".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)})})),Fe.maxKey=mt(Fe.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(je(ht,function(e){Ke||(e=new CustomEvent(hn,{detail:e}),Ke=!0,dispatchEvent(e),Ke=!1)}),addEventListener(hn,function(e){e=e.detail,Ke||In(e)}));var nt,Ke=!1,Pr=function(){};return typeof BroadcastChannel<"u"&&((Pr=function(){(nt=new BroadcastChannel(hn)).onmessage=function(e){return e.data&&In(e.data)}})(),typeof nt.unref=="function"&&nt.unref(),je(ht,function(e){Ke||nt.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Ee.disableBfCache&&e.persisted){ve&&console.debug("Dexie: handling persisted pagehide"),nt!=null&&nt.close();for(var t=0,n=Qe;t<n.length;t++)n[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!Ee.disableBfCache&&e.persisted&&(ve&&console.debug("Dexie: handling persisted pageshow"),Pr(),In({all:new ie(-1/0,[[]])}))})),j.rejectionMapper=function(e,t){return!e||e instanceof He||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Hn[e.name]?e:(t=new Hn[e.name](t||e.message,e),"stack"in e&&ce(t,"stack",{get:function(){return this.inner.stack}}),t)},Wn(ve),x(Ee,Object.freeze({__proto__:null,Dexie:Ee,Entity:tr,PropModification:ct,RangeSet:ie,add:function(e){return new ct({add:e})},cmp:U,default:Ee,liveQuery:Or,mergeRanges:gt,rangesOverlap:vr,remove:function(e){return new ct({remove:e})},replacePrefix:function(e,t){return new ct({replacePrefix:[e,t]})}}),{default:Ee}),Ee})})(Dr);var bo=Dr.exports;const Mn=go(bo),Cr=Symbol.for("Dexie"),Jt=globalThis[Cr]||(globalThis[Cr]=Mn);if(Mn.semVer!==Jt.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Mn.semVer} and ${Jt.semVer}`);const{liveQuery:qo,mergeRanges:Ro,rangesOverlap:Bo,RangeSet:Mo,cmp:Lo,Entity:No,PropModification:$o,replacePrefix:Fo,add:Uo,remove:Vo,DexieYProvider:zo}=Jt,be=new Jt("JobTrackerDB");be.version(1).stores({users:"id, username",jobs:"id, userId, company, role, status"});var ae=[];for(var Rn=0;Rn<256;++Rn)ae.push((Rn+256).toString(16).slice(1));function wo(w,A=0){return(ae[w[A+0]]+ae[w[A+1]]+ae[w[A+2]]+ae[w[A+3]]+"-"+ae[w[A+4]]+ae[w[A+5]]+"-"+ae[w[A+6]]+ae[w[A+7]]+"-"+ae[w[A+8]]+ae[w[A+9]]+"-"+ae[w[A+10]]+ae[w[A+11]]+ae[w[A+12]]+ae[w[A+13]]+ae[w[A+14]]+ae[w[A+15]]).toLowerCase()}var Wt,xo=new Uint8Array(16);function ko(){if(!Wt&&(Wt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Wt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Wt(xo)}var _o=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const jr={randomUUID:_o};function Tr(w,A,C){if(jr.randomUUID&&!w)return jr.randomUUID();w=w||{};var x=w.random||(w.rng||ko)();return x[6]=x[6]&15|64,x[8]=x[8]&63|128,wo(x)}const Bn="job_tracker_session",le={async register(w,A){if(await be.users.where("username").equals(w).first())throw new Error("Username already exists");const x={id:Tr(),username:w,password:A,createdAt:new Date};return await be.users.add(x),x},async login(w,A){const C=await be.users.where("username").equals(w).first();if(!C||C.password!==A)throw new Error("Invalid credentials");return this.setSession(C),C},logout(){localStorage.removeItem(Bn)},setSession(w){localStorage.setItem(Bn,JSON.stringify({id:w.id,username:w.username}))},getUser(){const w=localStorage.getItem(Bn);return w?JSON.parse(w):null},isAuthenticated(){return!!this.getUser()}};async function Eo(){const w=document.createElement("div");return w.className="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",w.innerHTML=`
    <div class="max-w-md w-full space-y-8 p-10 bg-white rounded-xl shadow-lg">
      <div class="text-center">
        <h2 class="mt-6 text-3xl font-extrabold text-gray-900">Job Tracker</h2>
        <p class="mt-2 text-sm text-gray-600">Sign in to your account</p>
      </div>
      <form class="mt-8 space-y-6" id="login-form">
        <div class="rounded-md shadow-sm -space-y-px">
          <div>
            <label for="username" class="sr-only">Username</label>
            <input id="username" name="username" type="text" required class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm" placeholder="Username">
          </div>
          <div>
            <label for="password" class="sr-only">Password</label>
            <input id="password" name="password" type="password" required class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm" placeholder="Password">
          </div>
        </div>

        <div>
          <button type="submit" class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
            Sign in
          </button>
        </div>
        
        <div class="text-sm text-center">
          <a href="#/register" class="font-medium text-blue-600 hover:text-blue-500">
            Don't have an account? Register
          </a>
        </div>
      </form>
    </div>
  `,w.querySelector("#login-form").addEventListener("submit",async A=>{A.preventDefault();const C=new FormData(A.target);try{await le.login(C.get("username"),C.get("password")),window.location.hash="/"}catch(x){alert(x.message)}}),w}async function So(){const w=document.createElement("div");return w.className="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",w.innerHTML=`
    <div class="max-w-md w-full space-y-8 p-10 bg-white rounded-xl shadow-lg">
      <div class="text-center">
        <h2 class="mt-6 text-3xl font-extrabold text-gray-900">Create Account</h2>
        <p class="mt-2 text-sm text-gray-600">Start tracking your applications</p>
      </div>
      <form class="mt-8 space-y-6" id="register-form">
        <div class="rounded-md shadow-sm -space-y-px">
          <div>
            <label for="username" class="sr-only">Username</label>
            <input id="username" name="username" type="text" required class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm" placeholder="Username">
          </div>
          <div>
            <label for="password" class="sr-only">Password</label>
            <input id="password" name="password" type="password" required class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm" placeholder="Password">
          </div>
        </div>

        <div>
          <button type="submit" class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
            Register
          </button>
        </div>
        
        <div class="text-sm text-center">
          <a href="#/login" class="font-medium text-blue-600 hover:text-blue-500">
            Already have an account? Sign in
          </a>
        </div>
      </form>
    </div>
  `,w.querySelector("#register-form").addEventListener("submit",async A=>{A.preventDefault();const C=new FormData(A.target);try{await le.register(C.get("username"),C.get("password")),await le.login(C.get("username"),C.get("password")),window.location.hash="/"}catch(x){alert(x.message)}}),w}function bt(w){const A=le.getUser(),C=window.location.hash.slice(1)||"/";if(!A){if(typeof w=="string"){const D=document.createElement("div");return D.innerHTML=w,D}return w}const x=D=>C===D||D!=="/"&&C.startsWith(D)?"bg-indigo-600 shadow-lg shadow-indigo-500/30 text-white ring-1 ring-white/20":"text-indigo-100/70 hover:bg-white/10 hover:text-white",N=document.createElement("div");N.className="flex h-screen overflow-hidden",N.innerHTML=`
      <!-- Sidebar -->
      <aside class="w-72 bg-black/40 backdrop-blur-xl border-r border-white/10 text-white hidden md:flex flex-col transition-all duration-300 relative z-20 shadow-2xl">
        <div class="p-6 flex items-center gap-3 border-b border-white/10 bg-white/5">
            <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg shadow-indigo-500/30">
                <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
            </div>
            <span class="text-xl font-bold text-white tracking-tight text-shadow-sm">JobTrackr</span>
        </div>
        
        <nav class="flex-1 px-4 space-y-2 py-6 overflow-y-auto">
          <a href="#/" class="flex items-center px-4 py-3 rounded-xl transition-all duration-200 group ${x("/")}">
            <svg class="w-5 h-5 mr-3 transition-transform group-hover:scale-110" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>
            <span class="font-medium tracking-wide">Dashboard</span>
            ${x("/")?'<div class="ml-auto w-1.5 h-1.5 rounded-full bg-white shadow-sm"></div>':""}
          </a>
          <a href="#/applications" class="flex items-center px-4 py-3 rounded-xl transition-all duration-200 group ${x("/applications")}">
            <svg class="w-5 h-5 mr-3 transition-transform group-hover:scale-110" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>
            <span class="font-medium tracking-wide">Applications</span>
            ${x("/applications")?'<div class="ml-auto w-1.5 h-1.5 rounded-full bg-white shadow-sm"></div>':""}
          </a>
          <a href="#/board" class="flex items-center px-4 py-3 rounded-xl transition-all duration-200 group ${x("/board")}">
             <svg class="w-5 h-5 mr-3 transition-transform group-hover:scale-110" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2" /></svg>
             <span class="font-medium tracking-wide">Kanban Board</span>
             ${x("/board")?'<div class="ml-auto w-1.5 h-1.5 rounded-full bg-white shadow-sm"></div>':""}
          </a>
        </nav>
        
        <div class="p-6 border-t border-white/10">
          <div class="flex items-center gap-3 p-3 rounded-xl bg-white/5 border border-white/5 group hover:bg-white/10 transition-colors cursor-pointer">
             <div class="w-9 h-9 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 shadow-lg flex items-center justify-center text-sm font-bold border-2 border-white/20">
                ${A.username[0].toUpperCase()}
             </div>
             <div class="flex-1 min-w-0">
                <p class="text-sm font-medium truncate text-white">${A.username}</p>
                <button id="layout-logout-btn" class="text-xs text-indigo-300 hover:text-white transition-colors flex items-center gap-1 mt-0.5">
                   Log out
                   <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
                </button>
             </div>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 overflow-auto relative z-10 scrollbar-thin scrollbar-thumb-indigo-500/20 scrollbar-track-transparent" id="main-content">
        <div class="p-6 md:p-10 max-w-7xl mx-auto space-y-6">
        </div>
      </main>
  `;const q=N.querySelector("#main-content > div");typeof w=="string"?q.innerHTML=w:w instanceof Node&&q.appendChild(w);const E=N.querySelector("#layout-logout-btn");return E&&E.addEventListener("click",D=>{D.stopPropagation(),le.logout(),window.location.hash="/login"}),N}const Ln={WISHLIST:"WISHLIST",APPLIED:"APPLIED",SCREENING:"SCREENING",INTERVIEW:"INTERVIEW",OFFER:"OFFER",REJECTED:"REJECTED",GHOSTED:"GHOSTED"},oe={async create(w,A){const C={id:Tr(),userId:A,...w,createdAt:new Date,updatedAt:new Date,notes:[]};return await be.jobs.add(C),C},async getAll(w){return await be.jobs.where("userId").equals(w).reverse().sortBy("createdAt")},async update(w,A){return A.updatedAt=new Date,await be.jobs.update(w,A),await be.jobs.get(w)},async delete(w){await be.jobs.delete(w)},async get(w){return await be.jobs.get(w)}};async function Oo(){const w=le.getUser(),A=await oe.getAll(w.id),C=A.length,x=A.filter(E=>["APPLIED","SCREENING","INTERVIEW","OFFER"].includes(E.status)).length,N=A.filter(E=>E.status==="INTERVIEW").length,q=document.createElement("div");return q.innerHTML=`
        <div class="mb-8">
            <h1 class="text-3xl font-extrabold text-white mb-2 tracking-tight">Welcome back, ${w.username}!</h1>
            <p class="text-indigo-200">Here's what's happening with your applications today.</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="glass-panel p-6 rounded-2xl relative overflow-hidden group">
                <div class="absolute right-0 top-0 w-32 h-32 bg-blue-500/10 rounded-bl-full -mr-10 -mt-10 transition-transform group-hover:scale-110"></div>
                <h3 class="text-indigo-900/60 text-xs font-bold uppercase tracking-wider mb-2">Total Applications</h3>
                <p class="text-4xl font-black text-indigo-900">${C}</p>
                <div class="mt-4 flex items-center text-sm text-indigo-600/80">
                   <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>
                   Tracking active
                </div>
            </div>
            
            <div class="glass-panel p-6 rounded-2xl relative overflow-hidden group">
                <div class="absolute right-0 top-0 w-32 h-32 bg-green-500/10 rounded-bl-full -mr-10 -mt-10 transition-transform group-hover:scale-110"></div>
                <h3 class="text-green-900/60 text-xs font-bold uppercase tracking-wider mb-2">Active Processes</h3>
                <p class="text-4xl font-black text-gray-900">${x}</p>
                 <div class="mt-4 flex items-center text-sm text-green-700/80">
                   <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                   In progress
                </div>
            </div>
            
            <div class="glass-panel p-6 rounded-2xl relative overflow-hidden group">
                 <div class="absolute right-0 top-0 w-32 h-32 bg-purple-500/10 rounded-bl-full -mr-10 -mt-10 transition-transform group-hover:scale-110"></div>
                <h3 class="text-purple-900/60 text-xs font-bold uppercase tracking-wider mb-2">Interviews</h3>
                <p class="text-4xl font-black text-purple-900">${N}</p>
                 <div class="mt-4 flex items-center text-sm text-purple-700/80">
                   <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                   Coming up
                </div>
            </div>
        </div>

        <div class="glass-panel rounded-2xl p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                <svg class="w-5 h-5 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                Recent Activity
            </h2>
            
            ${A.length===0?'<p class="text-gray-500 italic">No activity yet. Start by adding an application!</p>':""}
            
            <div class="space-y-3">
                ${A.slice(0,5).map(E=>{const D=`https://ui-avatars.com/api/?name=${encodeURIComponent(E.company)}&background=random&color=fff&size=64`;return`
                    <div class="group flex items-center justify-between p-3 rounded-xl hover:bg-indigo-50/50 border border-transparent hover:border-indigo-100 transition-all cursor-pointer" onclick="window.location.hash='/applications/${E.id}'">
                        <div class="flex items-center gap-4">
                            <img src="${D}" alt="${E.company}" class="w-10 h-10 rounded-lg shadow-sm">
                            <div>
                                <h4 class="font-bold text-gray-900 group-hover:text-indigo-700 transition-colors">${E.company}</h4>
                                <p class="text-sm text-gray-500">${E.role}</p>
                            </div>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-semibold bg-white/60 text-gray-600 border border-gray-200 backdrop-blur-sm">${E.status}</span>
                    </div>
                    `}).join("")}
            </div>
        </div>
    `,bt(q)}function Gt({onSubmit:w,onCancel:A,initialData:C={}}){const x=document.createElement("div");x.className="fixed inset-0 z-50 flex items-center justify-center bg-gray-900/60 backdrop-blur-sm px-4 opacity-0 transition-opacity duration-300",setTimeout(()=>x.classList.remove("opacity-0"),10);const N=!!C.id;x.innerHTML=`
    <div class="bg-white/90 backdrop-blur-xl rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden transform scale-95 transition-transform duration-300" id="modal-panel">
      <div class="px-8 py-6 border-b border-gray-200/50 flex justify-between items-center bg-white/50">
        <h3 class="text-xl font-bold text-gray-900">${N?"Edit Application":"New Application"}</h3>
        <button type="button" class="text-gray-400 hover:text-gray-600 transition-colors p-1 rounded-full hover:bg-gray-100" id="close-btn">
          <span class="sr-only">Close</span>
          <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      
      <form id="job-form" class="p-8 space-y-5">
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-1">Company</label>
          <input type="text" name="company" required value="${C.company||""}" class="glass-input w-full rounded-xl px-4 py-2.5">
        </div>
        
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-1">Role</label>
          <input type="text" name="role" required value="${C.role||""}" class="glass-input w-full rounded-xl px-4 py-2.5">
        </div>

        <div class="grid grid-cols-2 gap-5">
           <div>
              <label class="block text-sm font-semibold text-gray-700 mb-1">Status</label>
              <select name="status" class="glass-input w-full rounded-xl px-4 py-2.5">
                 ${Object.values(Ln).map(E=>`
                    <option value="${E}" ${C.status===E?"selected":""}>${E}</option>
                 `).join("")}
              </select>
           </div>
           <div>
              <label class="block text-sm font-semibold text-gray-700 mb-1">Location</label>
              <input type="text" name="location" value="${C.location||""}" class="glass-input w-full rounded-xl px-4 py-2.5">
           </div>
        </div>
        
        <div class="grid grid-cols-2 gap-5">
             <div>
              <label class="block text-sm font-semibold text-gray-700 mb-1">Salary</label>
              <input type="text" name="salary" value="${C.salary||""}" class="glass-input w-full rounded-xl px-4 py-2.5">
             </div>
             <div>
               <label class="block text-sm font-semibold text-gray-700 mb-1">Link</label>
               <input type="url" name="link" value="${C.link||""}" class="glass-input w-full rounded-xl px-4 py-2.5">
             </div>
        </div>

        <div class="flex justify-end pt-6 space-x-3 border-t border-gray-100">
          <button type="button" class="px-4 py-2 rounded-xl text-sm font-semibold text-gray-600 hover:bg-gray-100 hover:text-gray-900 transition-colors" id="cancel-btn">
            Cancel
          </button>
          <button type="submit" class="px-6 py-2 rounded-xl text-sm font-bold text-white bg-indigo-600 hover:bg-indigo-700 shadow-lg shadow-indigo-200 hover:shadow-indigo-300 transition-all transform hover:-translate-y-0.5">
            Save Application
          </button>
        </div>
      </form>
    </div>
  `,setTimeout(()=>{x.querySelector("#modal-panel").classList.remove("scale-95"),x.querySelector("#modal-panel").classList.add("scale-100")},10);const q=()=>{x.remove(),A&&A()};return x.querySelector("#close-btn").addEventListener("click",q),x.querySelector("#cancel-btn").addEventListener("click",q),x.querySelector("#job-form").addEventListener("submit",E=>{E.preventDefault();const D=new FormData(E.target),L=Object.fromEntries(D.entries());w(L),x.remove()}),x}async function Po(){const w=le.getUser();if(!w)return document.createElement("div");let A=await oe.getAll(w.id),C={search:"",status:"ALL",sort:"newest"};const x=document.createElement("div"),N=()=>{let E=[...A];if(C.status!=="ALL"&&(E=E.filter(D=>D.status===C.status)),C.search){const D=C.search.toLowerCase();E=E.filter(L=>L.company.toLowerCase().includes(D)||L.role.toLowerCase().includes(D))}return C.sort==="newest"?E.sort((D,L)=>new Date(L.createdAt)-new Date(D.createdAt)):C.sort==="oldest"?E.sort((D,L)=>new Date(D.createdAt)-new Date(L.createdAt)):C.sort==="company"&&E.sort((D,L)=>D.company.localeCompare(L.company)),E},q=()=>{const E=N(),D=()=>E.map(F=>{const se=`https://ui-avatars.com/api/?name=${encodeURIComponent(F.company)}&background=random&color=fff&size=128`,ce=me=>({APPLIED:"bg-blue-100 text-blue-800",INTERVIEW:"bg-purple-100 text-purple-800",OFFER:"bg-green-100 text-green-800",REJECTED:"bg-red-100 text-red-800",GHOSTED:"bg-gray-100 text-gray-800",WISHLIST:"bg-yellow-100 text-yellow-800",SCREENING:"bg-indigo-100 text-indigo-800"})[me]||"bg-gray-100 text-gray-800";return`
            <tr class="hover:bg-white/60 transition-colors cursor-pointer group" onclick="window.location.hash='/applications/${F.id}'">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="flex-shrink-0 h-10 w-10">
                    <img class="h-10 w-10 rounded-full shadow-sm" src="${se}" alt="${F.company}">
                  </div>
                  <div class="ml-4">
                    <div class="text-sm font-bold text-gray-900">${F.company}</div>
                    ${F.link?`<a href="${F.link}" target="_blank" onclick="event.stopPropagation()" class="text-xs text-indigo-500 hover:text-indigo-700 hover:underline">Visit Website</a>`:""}
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900">${F.role}</div>
                <div class="text-xs text-gray-500">${F.salary||"Salary not specified"}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full ${ce(F.status)}">
                  ${F.status}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <div class="flex items-center gap-1">
                    <svg class="w-3.5 h-3.5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                    ${F.location||"Remote"}
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                ${new Date(F.updatedAt).toLocaleDateString()}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <button data-id="${F.id}" class="edit-btn text-indigo-600 hover:text-indigo-900 bg-indigo-50 p-2 rounded-lg transition-colors hover:bg-indigo-100 mr-2" onclick="event.stopPropagation()">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                </button>
                <button data-id="${F.id}" class="delete-btn text-red-600 hover:text-red-900 bg-red-50 p-2 rounded-lg transition-colors hover:bg-red-100" onclick="event.stopPropagation()">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                </button>
              </td>
            </tr>
            `}).join("");x.innerHTML=`
      <div class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4">
        <h1 class="text-2xl font-bold text-gray-900">Applications</h1>
        <button id="add-job-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center justify-center gap-2">
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
          Add Application
        </button>
      </div>

      <div class="bg-white p-4 rounded-lg shadow mb-6 space-y-4 md:space-y-0 md:flex md:gap-4">
        <div class="flex-1">
            <input type="text" id="search-input" placeholder="Search company or role..." value="${C.search}" 
            class="w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div class="w-full md:w-48">
            <select id="status-filter" class="w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                <option value="ALL">All Status</option>
                ${Object.values(Ln).map(F=>`<option value="${F}" ${C.status===F?"selected":""}>${F}</option>`).join("")}
            </select>
        </div>
        <div class="w-full md:w-48">
            <select id="sort-filter" class="w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                <option value="newest" ${C.sort==="newest"?"selected":""}>Newest First</option>
                <option value="oldest" ${C.sort==="oldest"?"selected":""}>Oldest First</option>
                <option value="company" ${C.sort==="company"?"selected":""}>Company A-Z</option>
            </select>
        </div>
      </div>

      <div class="bg-white/30 backdrop-blur-lg rounded-lg shadow overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-white/50 backdrop-blur-lg">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Company</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role / Salary</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Location</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Updated</th>
              <th scope="col" class="relative px-6 py-3"><span class="sr-only">Edit</span></th>
            </tr>
          </thead>
          <tbody class="bg-white/40 divide-y divide-gray-200">
            ${D()}
          </tbody>
        </table>
        ${E.length===0?'<p class="p-4 text-center text-gray-500">No applications found.</p>':""}
      </div>
    `;const L=x.querySelector("#add-job-btn");L&&L.addEventListener("click",()=>{const F=Gt({onSubmit:async se=>{await oe.create(se,w.id),A=await oe.getAll(w.id),q()}});document.body.appendChild(F)});const G=x.querySelector("#search-input");G&&G.addEventListener("change",F=>{C.search=F.target.value,q()});const he=x.querySelector("#status-filter");he&&he.addEventListener("change",F=>{C.status=F.target.value,q()});const te=x.querySelector("#sort-filter");te&&te.addEventListener("change",F=>{C.sort=F.target.value,q()}),x.querySelectorAll(".delete-btn").forEach(F=>{F.addEventListener("click",async se=>{se.stopPropagation(),confirm("Are you sure?")&&(await oe.delete(se.target.dataset.id),A=await oe.getAll(w.id),q())})}),x.querySelectorAll(".edit-btn").forEach(F=>{F.addEventListener("click",async se=>{se.stopPropagation();const ce=A.find(Ve=>Ve.id===se.target.dataset.id),me=Gt({initialData:ce,onSubmit:async Ve=>{await oe.update(ce.id,Ve),A=await oe.getAll(w.id),q()}});document.body.appendChild(me)})})};return q(),bt(x)}async function Ao(w){if(!le.getUser())return document.createElement("div");if(!await oe.get(w.id)){const E=document.createElement("div");return E.innerHTML='<p class="p-4 text-red-500">Job not found</p>',bt(E)}const x=E=>{let D="";switch(E){case"Applied":D="bg-blue-100 text-blue-800";break;case"Interviewing":D="bg-purple-100 text-purple-800";break;case"Offer":D="bg-green-100 text-green-800";break;case"Rejected":D="bg-red-100 text-red-800";break;default:D="bg-gray-100 text-gray-800"}return`<span class="px-3 py-1 rounded-full text-sm font-semibold ${D}">${E}</span>`},N=document.createElement("div"),q=async()=>{const E=await oe.get(w.id),D=`https://ui-avatars.com/api/?name=${encodeURIComponent(E.company)}&background=random&color=fff&size=128`;N.innerHTML=`
            <div class="max-w-5xl mx-auto space-y-6">
                <!-- Header Card -->
                <div class="glass-panel p-8 rounded-2xl flex flex-col md:flex-row items-start md:items-center justify-between gap-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-indigo-500/10 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"></div>
                    
                    <div class="flex items-center gap-6 z-10">
                        <img src="${D}" alt="${E.company}" class="w-20 h-20 rounded-2xl shadow-lg ring-4 ring-white/50">
                        <div>
                            <h1 class="text-3xl font-black text-gray-900 tracking-tight">${E.role}</h1>
                            <div class="flex items-center gap-3 mt-2 text-gray-600 font-medium">
                                <span class="flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>
                                    ${E.company}
                                </span>
                                <span>â¢</span>
                                <span class="flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                                    ${E.location||"Remote"}
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center gap-3 z-10">
                         ${x(E.status)}
                         <button id="edit-job-btn" class="p-2 bg-white/50 hover:bg-white rounded-lg text-indigo-600 transition-all shadow-sm">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                         </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Main details -->
                    <div class="md:col-span-2 space-y-6">
                        <div class="glass-panel p-6 rounded-2xl">
                            <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-4 border-b border-gray-100 pb-2">Job Details</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <p class="text-xs text-gray-500 mb-1">Salary Range</p>
                                    <p class="font-semibold text-gray-900 flex items-center gap-2">
                                        <svg class="w-4 h-4 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                        ${E.salary||"Not specified"}
                                    </p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-500 mb-1">Date Applied</p>
                                    <p class="font-semibold text-gray-900 flex items-center gap-2">
                                        <svg class="w-4 h-4 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                                        ${new Date(E.createdAt).toLocaleDateString()}
                                    </p>
                                </div>
                                <div class="md:col-span-2">
                                    <p class="text-xs text-gray-500 mb-1">Job Link</p>
                                    ${E.link?`<a href="${E.link}" target="_blank" class="flex items-center gap-2 text-blue-600 hover:text-blue-800 font-medium group">
                                            ${E.link} 
                                            <svg class="w-4 h-4 group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                                        </a>`:'<span class="text-gray-400">No link provided</span>'}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notes Column -->
                    <div class="md:col-span-1">
                        <div class="glass-panel p-6 rounded-2xl h-full flex flex-col shadow-lg border-t-4 border-indigo-400">
                            <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-4 flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                                Private Notes
                            </h3>
                            <div class="flex-1 overflow-y-auto max-h-[400px] space-y-3 mb-4 pr-1 scrollbar-thin" id="notes-list">
                                ${(E.notes||[]).length===0?'<div class="text-center py-8 text-gray-400"><p>No notes yet.</p><p class="text-xs mt-1">Keep track of interview details here.</p></div>':""}
                                ${(E.notes||[]).sort((L,G)=>new Date(G.date)-new Date(L.date)).map(L=>`
                                    <div class="bg-white/60 p-3 rounded-xl shadow-sm border border-white/50 backdrop-blur-sm">
                                        <p class="text-gray-800 whitespace-pre-wrap text-sm leading-relaxed">${L.content}</p>
                                        <p class="text-[10px] text-indigo-400/80 mt-2 font-medium text-right">${new Date(L.date).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}</p>
                                    </div>
                                `).join("")}
                            </div>
                            <form id="note-form" class="mt-auto pt-4 border-t border-gray-100">
                                <textarea name="content" required placeholder="Type a note..." class="w-full text-sm bg-white/50 border-gray-200 rounded-xl focus:ring-0 focus:border-indigo-500 focus:bg-white transition-all shadow-inner p-3 mb-2 resize-none" rows="3"></textarea>
                                <button type="submit" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-medium py-2 px-4 rounded-xl shadow-md hover:shadow-lg transform active:scale-95 transition-all text-sm">Add Note</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        `,N.querySelector("#note-form").addEventListener("submit",async L=>{L.preventDefault();const he=L.target.querySelector("textarea").value.trim();if(!he)return;const te={id:Date.now(),content:he,date:new Date},se=(await oe.get(w.id)).notes||[];se.push(te),await oe.update(w.id,{notes:se}),q()}),N.querySelector("#edit-job-btn").addEventListener("click",()=>{const L=Gt({initialData:E,onSubmit:async G=>{await oe.update(E.id,G),q()}});document.body.appendChild(L)})};return await q(),bt(N)}const Kr={WISHLIST:"bg-gray-100 text-gray-700 border-gray-200",APPLIED:"bg-blue-50 text-blue-700 border-blue-200",SCREENING:"bg-indigo-50 text-indigo-700 border-indigo-200",INTERVIEW:"bg-purple-50 text-purple-700 border-purple-200 ring-4 ring-purple-500/10",OFFER:"bg-green-50 text-green-700 border-green-200 shadow-green-100",REJECTED:"bg-red-50 text-red-700 border-red-200",GHOSTED:"bg-slate-100 text-slate-500 border-slate-200 grayscale"};function Co(w){return`
        <span class="px-2.5 py-0.5 rounded-full text-xs font-semibold border ${Kr[w]||Kr.WISHLIST} inline-flex items-center gap-1.5 shadow-sm">
            <span class="w-1.5 h-1.5 rounded-full bg-current opacity-75"></span>
            ${w}
        </span>
    `}function jo(w){const A=document.createElement("div");A.className="glass-panel p-4 rounded-xl hover:scale-[1.02] hover:shadow-2xl transition-all duration-300 cursor-pointer group relative overflow-hidden",A.draggable=!0,A.dataset.id=w.id;const C=Math.floor((new Date-new Date(w.updatedAt))/(1e3*60*60*24));return A.innerHTML=`
        <div class="absolute top-0 right-0 w-24 h-24 bg-gradient-to-br from-indigo-500/5 to-purple-500/5 rounded-bl-full -mr-8 -mt-8 transition-transform group-hover:scale-150 duration-500"></div>
    
        <div class="relative z-10 flex justify-between items-start mb-3">
             <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-gray-50 to-gray-100 shadow-inner border border-gray-100 flex items-center justify-center text-lg font-bold text-gray-700">
                ${w.company[0].toUpperCase()}
             </div>
             ${Co(w.status)}
        </div>
        
        <div class="relative z-10">
            <h3 class="font-bold text-gray-900 text-lg leading-tight mb-1 group-hover:text-indigo-600 transition-colors line-clamp-1">${w.role}</h3>
            <p class="text-sm text-gray-500 font-medium mb-4 line-clamp-1">${w.company}</p>
            
            <div class="flex items-center justify-between pt-3 border-t border-gray-100/50 mt-3">
                <p class="text-xs text-gray-400 font-medium flex items-center gap-1">
                    <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    ${C===0?"Today":`${C}d ago`}
                </p>
                ${w.link?`
                    <a href="${w.link}" target="_blank" class="p-1.5 rounded-full text-indigo-400 hover:text-white hover:bg-indigo-500 transition-all opacity-0 group-hover:opacity-100" onclick="event.stopPropagation()">
                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                    </a>
                `:""}
            </div>
        </div>
    `,A}async function Ko(){const w=le.getUser();if(!w)return document.createElement("div");let A=await oe.getAll(w.id);const C=document.createElement("div"),x=Object.values(Ln),N=()=>{C.innerHTML=`
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-2xl font-bold text-gray-900">Kanban Board</h1>
                <button id="add-job-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 shadow-md shadow-indigo-200 transition-all flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                    Add Card
                </button>
            </div>
            
            <div class="flex overflow-x-auto pb-8 gap-6 snap-x">
                ${x.map(q=>`
                    <div class="min-w-[300px] w-80 flex-shrink-0 flex flex-col bg-gray-100/50 rounded-xl" data-status="${q}">
                        <div class="p-3 font-semibold text-gray-500 uppercase text-xs tracking-wider flex justify-between items-center">
                            ${q}
                            <span class="bg-gray-200 text-gray-600 rounded-full px-2 py-0.5 text-[10px] count-badge">${A.filter(E=>E.status===q).length}</span>
                        </div>
                        <div class="flex-1 p-2 space-y-3 min-h-[150px] transition-colors rounded-xl" id="col-${q}">
                            <!-- Cards go here via JS to preserve events -->
                        </div>
                    </div>
                `).join("")}
            </div>
        `,x.forEach(q=>{const E=C.querySelector(`#col-${q}`),D=A.filter(L=>L.status===q);E.addEventListener("dragover",L=>{L.preventDefault(),E.classList.add("bg-indigo-50/50","ring-2","ring-indigo-200")}),E.addEventListener("dragleave",()=>{E.classList.remove("bg-indigo-50/50","ring-2","ring-indigo-200")}),E.addEventListener("drop",async L=>{L.preventDefault(),E.classList.remove("bg-indigo-50/50","ring-2","ring-indigo-200");const G=L.dataTransfer.getData("text/plain");G&&(await oe.update(G,{status:q}),A=await oe.getAll(w.id),N())}),D.forEach(L=>{const G=jo(L);G.draggable=!0,G.addEventListener("dragstart",he=>{he.dataTransfer.setData("text/plain",L.id),he.dataTransfer.effectAllowed="move",setTimeout(()=>G.classList.add("opacity-50"),0)}),G.addEventListener("dragend",()=>{G.classList.remove("opacity-50")}),G.addEventListener("click",()=>{window.location.hash=`/applications/${L.id}`}),E.appendChild(G)})}),C.querySelector("#add-job-btn").addEventListener("click",()=>{const q=Gt({onSubmit:async E=>{await oe.create(E,w.id),A=await oe.getAll(w.id),N()}});document.body.appendChild(q)})};return N(),bt(C)}const Do=[{path:"/login",component:Eo},{path:"/register",component:So},{path:"/",component:Oo,guard:()=>le.isAuthenticated()},{path:"/applications",component:Po,guard:()=>le.isAuthenticated()},{path:"/applications/:id",component:Ao,guard:()=>le.isAuthenticated()},{path:"/board",component:Ko,guard:()=>le.isAuthenticated()}],To=document.querySelector("#app"),Io=new yo(Do,To);document.addEventListener("click",w=>{w.target.id==="logout-btn"&&(le.logout(),Io.navigate("/login"))});
